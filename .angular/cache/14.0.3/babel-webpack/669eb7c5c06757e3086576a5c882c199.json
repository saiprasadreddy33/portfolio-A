{"ast":null,"code":"/**\n * Copyright (C) 2010-2015 Graham Breach\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n * \n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/**\n * TagCanvas 2.9\n * For more information, please contact <graham@goat1000.com>\n */\n(function () {\n  \"use strict\";\n\n  var i,\n      j,\n      abs = Math.abs,\n      sin = Math.sin,\n      cos = Math.cos,\n      max = Math.max,\n      min = Math.min,\n      ceil = Math.ceil,\n      sqrt = Math.sqrt,\n      pow = Math.pow,\n      hexlookup3 = {},\n      hexlookup2 = {},\n      hexlookup1 = {\n    0: \"0,\",\n    1: \"17,\",\n    2: \"34,\",\n    3: \"51,\",\n    4: \"68,\",\n    5: \"85,\",\n    6: \"102,\",\n    7: \"119,\",\n    8: \"136,\",\n    9: \"153,\",\n    a: \"170,\",\n    A: \"170,\",\n    b: \"187,\",\n    B: \"187,\",\n    c: \"204,\",\n    C: \"204,\",\n    d: \"221,\",\n    D: \"221,\",\n    e: \"238,\",\n    E: \"238,\",\n    f: \"255,\",\n    F: \"255,\"\n  },\n      Oproto,\n      Tproto,\n      TCproto,\n      Mproto,\n      Vproto,\n      TSproto,\n      TCVproto,\n      doc = document,\n      ocanvas,\n      handlers = {};\n\n  for (i = 0; i < 256; ++i) {\n    j = i.toString(16);\n    if (i < 16) j = '0' + j;\n    hexlookup2[j] = hexlookup2[j.toUpperCase()] = i.toString() + ',';\n  }\n\n  function Defined(d) {\n    return typeof d != 'undefined';\n  }\n\n  function IsObject(o) {\n    return typeof o == 'object' && o != null;\n  }\n\n  function Clamp(v, mn, mx) {\n    return isNaN(v) ? mx : min(mx, max(mn, v));\n  }\n\n  function Nop() {\n    return false;\n  }\n\n  function TimeNow() {\n    return new Date().valueOf();\n  }\n\n  function SortList(l, f) {\n    var nl = [],\n        tl = l.length,\n        i;\n\n    for (i = 0; i < tl; ++i) nl.push(l[i]);\n\n    nl.sort(f);\n    return nl;\n  }\n\n  function Shuffle(a) {\n    var i = a.length - 1,\n        t,\n        p;\n\n    while (i) {\n      p = ~~(Math.random() * i);\n      t = a[i];\n      a[i] = a[p];\n      a[p] = t;\n      --i;\n    }\n  }\n\n  function Vector(x, y, z) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n  }\n\n  Vproto = Vector.prototype;\n\n  Vproto.length = function () {\n    return sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n  };\n\n  Vproto.dot = function (v) {\n    return this.x * v.x + this.y * v.y + this.z * v.z;\n  };\n\n  Vproto.cross = function (v) {\n    var x = this.y * v.z - this.z * v.y,\n        y = this.z * v.x - this.x * v.z,\n        z = this.x * v.y - this.y * v.x;\n    return new Vector(x, y, z);\n  };\n\n  Vproto.angle = function (v) {\n    var dot = this.dot(v),\n        ac;\n    if (dot == 0) return Math.PI / 2.0;\n    ac = dot / (this.length() * v.length());\n    if (ac >= 1) return 0;\n    if (ac <= -1) return Math.PI;\n    return Math.acos(ac);\n  };\n\n  Vproto.unit = function () {\n    var l = this.length();\n    return new Vector(this.x / l, this.y / l, this.z / l);\n  };\n\n  function MakeVector(lg, lt) {\n    lt = lt * Math.PI / 180;\n    lg = lg * Math.PI / 180;\n    var x = sin(lg) * cos(lt),\n        y = -sin(lt),\n        z = -cos(lg) * cos(lt);\n    return new Vector(x, y, z);\n  }\n\n  function Matrix(a) {\n    this[1] = {\n      1: a[0],\n      2: a[1],\n      3: a[2]\n    };\n    this[2] = {\n      1: a[3],\n      2: a[4],\n      3: a[5]\n    };\n    this[3] = {\n      1: a[6],\n      2: a[7],\n      3: a[8]\n    };\n  }\n\n  Mproto = Matrix.prototype;\n\n  Matrix.Identity = function () {\n    return new Matrix([1, 0, 0, 0, 1, 0, 0, 0, 1]);\n  };\n\n  Matrix.Rotation = function (angle, u) {\n    var sina = sin(angle),\n        cosa = cos(angle),\n        mcos = 1 - cosa;\n    return new Matrix([cosa + pow(u.x, 2) * mcos, u.x * u.y * mcos - u.z * sina, u.x * u.z * mcos + u.y * sina, u.y * u.x * mcos + u.z * sina, cosa + pow(u.y, 2) * mcos, u.y * u.z * mcos - u.x * sina, u.z * u.x * mcos - u.y * sina, u.z * u.y * mcos + u.x * sina, cosa + pow(u.z, 2) * mcos]);\n  };\n\n  Mproto.mul = function (m) {\n    var a = [],\n        i,\n        j,\n        mmatrix = m.xform ? 1 : 0;\n\n    for (i = 1; i <= 3; ++i) for (j = 1; j <= 3; ++j) {\n      if (mmatrix) a.push(this[i][1] * m[1][j] + this[i][2] * m[2][j] + this[i][3] * m[3][j]);else a.push(this[i][j] * m);\n    }\n\n    return new Matrix(a);\n  };\n\n  Mproto.xform = function (p) {\n    var a = {},\n        x = p.x,\n        y = p.y,\n        z = p.z;\n    a.x = x * this[1][1] + y * this[2][1] + z * this[3][1];\n    a.y = x * this[1][2] + y * this[2][2] + z * this[3][2];\n    a.z = x * this[1][3] + y * this[2][3] + z * this[3][3];\n    return a;\n  };\n\n  function PointsOnSphere(n, xr, yr, zr, magic) {\n    var i,\n        y,\n        r,\n        phi,\n        pts = [],\n        off = 2 / n,\n        inc;\n    inc = Math.PI * (3 - sqrt(5) + (parseFloat(magic) ? parseFloat(magic) : 0));\n\n    for (i = 0; i < n; ++i) {\n      y = i * off - 1 + off / 2;\n      r = sqrt(1 - y * y);\n      phi = i * inc;\n      pts.push([cos(phi) * r * xr, y * yr, sin(phi) * r * zr]);\n    }\n\n    return pts;\n  }\n\n  function Cylinder(n, o, xr, yr, zr, magic) {\n    var phi,\n        pts = [],\n        off = 2 / n,\n        inc,\n        i,\n        j,\n        k,\n        l;\n    inc = Math.PI * (3 - sqrt(5) + (parseFloat(magic) ? parseFloat(magic) : 0));\n\n    for (i = 0; i < n; ++i) {\n      j = i * off - 1 + off / 2;\n      phi = i * inc;\n      k = cos(phi);\n      l = sin(phi);\n      pts.push(o ? [j * xr, k * yr, l * zr] : [k * xr, j * yr, l * zr]);\n    }\n\n    return pts;\n  }\n\n  function Ring(o, n, xr, yr, zr, j) {\n    var phi,\n        pts = [],\n        inc = Math.PI * 2 / n,\n        i,\n        k,\n        l;\n\n    for (i = 0; i < n; ++i) {\n      phi = i * inc;\n      k = cos(phi);\n      l = sin(phi);\n      pts.push(o ? [j * xr, k * yr, l * zr] : [k * xr, j * yr, l * zr]);\n    }\n\n    return pts;\n  }\n\n  function PointsOnCylinderV(n, xr, yr, zr, m) {\n    return Cylinder(n, 0, xr, yr, zr, m);\n  }\n\n  function PointsOnCylinderH(n, xr, yr, zr, m) {\n    return Cylinder(n, 1, xr, yr, zr, m);\n  }\n\n  function PointsOnRingV(n, xr, yr, zr, offset) {\n    offset = isNaN(offset) ? 0 : offset * 1;\n    return Ring(0, n, xr, yr, zr, offset);\n  }\n\n  function PointsOnRingH(n, xr, yr, zr, offset) {\n    offset = isNaN(offset) ? 0 : offset * 1;\n    return Ring(1, n, xr, yr, zr, offset);\n  }\n\n  function CentreImage(t) {\n    var i = new Image();\n\n    i.onload = function () {\n      var dx = i.width / 2,\n          dy = i.height / 2;\n\n      t.centreFunc = function (c, w, h, cx, cy) {\n        c.setTransform(1, 0, 0, 1, 0, 0);\n        c.globalAlpha = 1;\n        c.drawImage(i, cx - dx, cy - dy);\n      };\n    };\n\n    i.src = t.centreImage;\n  }\n\n  function SetAlpha(c, a) {\n    var d = c,\n        p1,\n        p2,\n        ae = (a * 1).toPrecision(3) + ')';\n\n    if (c[0] === '#') {\n      if (!hexlookup3[c]) if (c.length === 4) hexlookup3[c] = 'rgba(' + hexlookup1[c[1]] + hexlookup1[c[2]] + hexlookup1[c[3]];else hexlookup3[c] = 'rgba(' + hexlookup2[c.substr(1, 2)] + hexlookup2[c.substr(3, 2)] + hexlookup2[c.substr(5, 2)];\n      d = hexlookup3[c] + ae;\n    } else if (c.substr(0, 4) === 'rgb(' || c.substr(0, 4) === 'hsl(') {\n      d = c.replace('(', 'a(').replace(')', ',' + ae);\n    } else if (c.substr(0, 5) === 'rgba(' || c.substr(0, 5) === 'hsla(') {\n      p1 = c.lastIndexOf(',') + 1, p2 = c.indexOf(')');\n      a *= parseFloat(c.substring(p1, p2));\n      d = c.substr(0, p1) + a.toPrecision(3) + ')';\n    }\n\n    return d;\n  }\n\n  function NewCanvas(w, h) {\n    // if using excanvas, give up now\n    if (window.G_vmlCanvasManager) return null;\n    var c = doc.createElement('canvas');\n    c.width = w;\n    c.height = h;\n    return c;\n  } // I think all browsers pass this test now...\n\n\n  function ShadowAlphaBroken() {\n    var cv = NewCanvas(3, 3),\n        c,\n        i;\n    if (!cv) return false;\n    c = cv.getContext('2d');\n    c.strokeStyle = '#000';\n    c.shadowColor = '#fff';\n    c.shadowBlur = 3;\n    c.globalAlpha = 0;\n    c.strokeRect(2, 2, 2, 2);\n    c.globalAlpha = 1;\n    i = c.getImageData(2, 2, 1, 1);\n    cv = null;\n    return i.data[0] > 0;\n  }\n\n  function SetGradient(c, l, o, g) {\n    var gd = c.createLinearGradient(0, 0, l, 0),\n        i;\n\n    for (i in g) gd.addColorStop(1 - i, g[i]);\n\n    c.fillStyle = gd;\n    c.fillRect(0, o, l, 1);\n  }\n\n  function FindGradientColour(tc, p, r) {\n    var l = 1024,\n        h = 1,\n        gl = tc.weightGradient,\n        cv,\n        c,\n        i,\n        d;\n\n    if (tc.gCanvas) {\n      c = tc.gCanvas.getContext('2d');\n      h = tc.gCanvas.height;\n    } else {\n      if (IsObject(gl[0])) h = gl.length;else gl = [gl];\n      tc.gCanvas = cv = NewCanvas(l, h);\n      if (!cv) return null;\n      c = cv.getContext('2d');\n\n      for (i = 0; i < h; ++i) SetGradient(c, l, i, gl[i]);\n    }\n\n    r = max(min(r || 0, h - 1), 0);\n    d = c.getImageData(~~((l - 1) * p), r, 1, 1).data;\n    return 'rgba(' + d[0] + ',' + d[1] + ',' + d[2] + ',' + d[3] / 255 + ')';\n  }\n\n  function TextSet(ctxt, font, colour, strings, padx, pady, shadowColour, shadowBlur, shadowOffsets, maxWidth, widths, align) {\n    var xo = padx + (shadowBlur || 0) + (shadowOffsets.length && shadowOffsets[0] < 0 ? abs(shadowOffsets[0]) : 0),\n        yo = pady + (shadowBlur || 0) + (shadowOffsets.length && shadowOffsets[1] < 0 ? abs(shadowOffsets[1]) : 0),\n        i,\n        xc;\n    ctxt.font = font;\n    ctxt.textBaseline = 'top';\n    ctxt.fillStyle = colour;\n    shadowColour && (ctxt.shadowColor = shadowColour);\n    shadowBlur && (ctxt.shadowBlur = shadowBlur);\n    shadowOffsets.length && (ctxt.shadowOffsetX = shadowOffsets[0], ctxt.shadowOffsetY = shadowOffsets[1]);\n\n    for (i = 0; i < strings.length; ++i) {\n      xc = 0;\n\n      if (widths) {\n        if ('right' == align) {\n          xc = maxWidth - widths[i];\n        } else if ('centre' == align) {\n          xc = (maxWidth - widths[i]) / 2;\n        }\n      }\n\n      ctxt.fillText(strings[i], xo + xc, yo);\n      yo += parseInt(font);\n    }\n  }\n\n  function RRect(c, x, y, w, h, r, s) {\n    if (r) {\n      c.beginPath();\n      c.moveTo(x, y + h - r);\n      c.arcTo(x, y, x + r, y, r);\n      c.arcTo(x + w, y, x + w, y + r, r);\n      c.arcTo(x + w, y + h, x + w - r, y + h, r);\n      c.arcTo(x, y + h, x, y + h - r, r);\n      c.closePath();\n      c[s ? 'stroke' : 'fill']();\n    } else {\n      c[s ? 'strokeRect' : 'fillRect'](x, y, w, h);\n    }\n  }\n\n  function TextCanvas(strings, font, w, h, maxWidth, stringWidths, align, valign, scale) {\n    this.strings = strings;\n    this.font = font;\n    this.width = w;\n    this.height = h;\n    this.maxWidth = maxWidth;\n    this.stringWidths = stringWidths;\n    this.align = align;\n    this.valign = valign;\n    this.scale = scale;\n  }\n\n  TCVproto = TextCanvas.prototype;\n\n  TCVproto.SetImage = function (image, w, h, position, padding, align, valign, scale) {\n    this.image = image;\n    this.iwidth = w * this.scale;\n    this.iheight = h * this.scale;\n    this.ipos = position;\n    this.ipad = padding * this.scale;\n    this.iscale = scale;\n    this.ialign = align;\n    this.ivalign = valign;\n  };\n\n  TCVproto.Align = function (size, space, a) {\n    var pos = 0;\n    if (a == 'right' || a == 'bottom') pos = space - size;else if (a != 'left' && a != 'top') pos = (space - size) / 2;\n    return pos;\n  };\n\n  TCVproto.Create = function (colour, bgColour, bgOutline, bgOutlineThickness, shadowColour, shadowBlur, shadowOffsets, padding, radius) {\n    var cv,\n        cw,\n        ch,\n        c,\n        x1,\n        x2,\n        y1,\n        y2,\n        offx,\n        offy,\n        ix,\n        iy,\n        iw,\n        ih,\n        rr,\n        sox = abs(shadowOffsets[0]),\n        soy = abs(shadowOffsets[1]),\n        shadowcv,\n        shadowc;\n    padding = max(padding, sox + shadowBlur, soy + shadowBlur);\n    x1 = 2 * (padding + bgOutlineThickness);\n    y1 = 2 * (padding + bgOutlineThickness);\n    cw = this.width + x1;\n    ch = this.height + y1;\n    offx = offy = padding + bgOutlineThickness;\n\n    if (this.image) {\n      ix = iy = padding + bgOutlineThickness;\n      iw = this.iwidth;\n      ih = this.iheight;\n\n      if (this.ipos == 'top' || this.ipos == 'bottom') {\n        if (iw < this.width) ix += this.Align(iw, this.width, this.ialign);else offx += this.Align(this.width, iw, this.align);\n        if (this.ipos == 'top') offy += ih + this.ipad;else iy += this.height + this.ipad;\n        cw = max(cw, iw + x1);\n        ch += ih + this.ipad;\n      } else {\n        if (ih < this.height) iy += this.Align(ih, this.height, this.ivalign);else offy += this.Align(this.height, ih, this.valign);\n        if (this.ipos == 'right') ix += this.width + this.ipad;else offx += iw + this.ipad;\n        cw += iw + this.ipad;\n        ch = max(ch, ih + y1);\n      }\n    }\n\n    cv = NewCanvas(cw, ch);\n    if (!cv) return null;\n    x1 = y1 = bgOutlineThickness / 2;\n    x2 = cw - bgOutlineThickness;\n    y2 = ch - bgOutlineThickness;\n    rr = min(radius, x2 / 2, y2 / 2);\n    c = cv.getContext('2d');\n\n    if (bgColour) {\n      c.fillStyle = bgColour;\n      RRect(c, x1, y1, x2, y2, rr);\n    }\n\n    if (bgOutlineThickness) {\n      c.strokeStyle = bgOutline;\n      c.lineWidth = bgOutlineThickness;\n      RRect(c, x1, y1, x2, y2, rr, true);\n    }\n\n    if (shadowBlur || sox || soy) {\n      // use a transparent canvas to draw on\n      shadowcv = NewCanvas(cw, ch);\n\n      if (shadowcv) {\n        shadowc = c;\n        c = shadowcv.getContext('2d');\n      }\n    } // don't use TextSet shadow support because it adds space for shadow\n\n\n    TextSet(c, this.font, colour, this.strings, offx, offy, 0, 0, [], this.maxWidth, this.stringWidths, this.align);\n    if (this.image) c.drawImage(this.image, ix, iy, iw, ih);\n\n    if (shadowc) {\n      // draw the text and image with the added shadow\n      c = shadowc;\n      shadowColour && (c.shadowColor = shadowColour);\n      shadowBlur && (c.shadowBlur = shadowBlur);\n      c.shadowOffsetX = shadowOffsets[0];\n      c.shadowOffsetY = shadowOffsets[1];\n      c.drawImage(shadowcv, 0, 0);\n    }\n\n    return cv;\n  };\n\n  function ExpandImage(i, w, h) {\n    var cv = NewCanvas(w, h),\n        c;\n    if (!cv) return null;\n    c = cv.getContext('2d');\n    c.drawImage(i, (w - i.width) / 2, (h - i.height) / 2);\n    return cv;\n  }\n\n  function ScaleImage(i, w, h) {\n    var cv = NewCanvas(w, h),\n        c;\n    if (!cv) return null;\n    c = cv.getContext('2d');\n    c.drawImage(i, 0, 0, w, h);\n    return cv;\n  }\n\n  function AddBackgroundToImage(i, w, h, scale, colour, othickness, ocolour, padding, radius, ofill) {\n    var cw = w + (2 * padding + othickness) * scale,\n        ch = h + (2 * padding + othickness) * scale,\n        cv = NewCanvas(cw, ch),\n        c,\n        x1,\n        y1,\n        x2,\n        y2,\n        ocanvas,\n        cc,\n        rr;\n    if (!cv) return null;\n    othickness *= scale;\n    radius *= scale;\n    x1 = y1 = othickness / 2;\n    x2 = cw - othickness;\n    y2 = ch - othickness;\n    padding = padding * scale + x1; // add space for outline\n\n    c = cv.getContext('2d');\n    rr = min(radius, x2 / 2, y2 / 2);\n\n    if (colour) {\n      c.fillStyle = colour;\n      RRect(c, x1, y1, x2, y2, rr);\n    }\n\n    if (othickness) {\n      c.strokeStyle = ocolour;\n      c.lineWidth = othickness;\n      RRect(c, x1, y1, x2, y2, rr, true);\n    }\n\n    if (ofill) {\n      // use compositing to colour in the image and border\n      ocanvas = NewCanvas(cw, ch);\n      cc = ocanvas.getContext('2d');\n      cc.drawImage(i, padding, padding, w, h);\n      cc.globalCompositeOperation = 'source-in';\n      cc.fillStyle = ocolour;\n      cc.fillRect(0, 0, cw, ch);\n      cc.globalCompositeOperation = 'destination-over';\n      cc.drawImage(cv, 0, 0);\n      cc.globalCompositeOperation = 'source-over';\n      c.drawImage(ocanvas, 0, 0);\n    } else {\n      c.drawImage(i, padding, padding, i.width, i.height);\n    }\n\n    return {\n      image: cv,\n      width: cw / scale,\n      height: ch / scale\n    };\n  }\n  /**\n   * Rounds off the corners of an image\n   */\n\n\n  function RoundImage(i, r, iw, ih, s) {\n    var cv,\n        c,\n        r1 = parseFloat(r),\n        l = max(iw, ih);\n    cv = NewCanvas(iw, ih);\n    if (!cv) return null;\n    if (r.indexOf('%') > 0) r1 = l * r1 / 100;else r1 = r1 * s;\n    c = cv.getContext('2d');\n    c.globalCompositeOperation = 'source-over';\n    c.fillStyle = '#fff';\n\n    if (r1 >= l / 2) {\n      r1 = min(iw, ih) / 2;\n      c.beginPath();\n      c.moveTo(iw / 2, ih / 2);\n      c.arc(iw / 2, ih / 2, r1, 0, 2 * Math.PI, false);\n      c.fill();\n      c.closePath();\n    } else {\n      r1 = min(iw / 2, ih / 2, r1);\n      RRect(c, 0, 0, iw, ih, r1, true);\n      c.fill();\n    }\n\n    c.globalCompositeOperation = 'source-in';\n    c.drawImage(i, 0, 0, iw, ih);\n    return cv;\n  }\n  /**\n   * Creates a new canvas containing the image and its shadow\n   * Returns an object containing the image and its dimensions at z=0\n   */\n\n\n  function AddShadowToImage(i, w, h, scale, sc, sb, so) {\n    var sw = abs(so[0]),\n        sh = abs(so[1]),\n        cw = w + (sw > sb ? sw + sb : sb * 2) * scale,\n        ch = h + (sh > sb ? sh + sb : sb * 2) * scale,\n        xo = scale * ((sb || 0) + (so[0] < 0 ? sw : 0)),\n        yo = scale * ((sb || 0) + (so[1] < 0 ? sh : 0)),\n        cv,\n        c;\n    cv = NewCanvas(cw, ch);\n    if (!cv) return null;\n    c = cv.getContext('2d');\n    sc && (c.shadowColor = sc);\n    sb && (c.shadowBlur = sb * scale);\n    so && (c.shadowOffsetX = so[0] * scale, c.shadowOffsetY = so[1] * scale);\n    c.drawImage(i, xo, yo, w, h);\n    return {\n      image: cv,\n      width: cw / scale,\n      height: ch / scale\n    };\n  }\n\n  function FindTextBoundingBox(s, f, ht) {\n    var w = parseInt(s.toString().length * ht),\n        h = parseInt(ht * 2 * s.length),\n        cv = NewCanvas(w, h),\n        c,\n        idata,\n        w1,\n        h1,\n        x,\n        y,\n        i,\n        ex;\n    if (!cv) return null;\n    c = cv.getContext('2d');\n    c.fillStyle = '#000';\n    c.fillRect(0, 0, w, h);\n    TextSet(c, ht + 'px ' + f, '#fff', s, 0, 0, 0, 0, [], 'centre');\n    idata = c.getImageData(0, 0, w, h);\n    w1 = idata.width;\n    h1 = idata.height;\n    ex = {\n      min: {\n        x: w1,\n        y: h1\n      },\n      max: {\n        x: -1,\n        y: -1\n      }\n    };\n\n    for (y = 0; y < h1; ++y) {\n      for (x = 0; x < w1; ++x) {\n        i = (y * w1 + x) * 4;\n\n        if (idata.data[i + 1] > 0) {\n          if (x < ex.min.x) ex.min.x = x;\n          if (x > ex.max.x) ex.max.x = x;\n          if (y < ex.min.y) ex.min.y = y;\n          if (y > ex.max.y) ex.max.y = y;\n        }\n      }\n    } // device pixels might not be css pixels\n\n\n    if (w1 != w) {\n      ex.min.x *= w / w1;\n      ex.max.x *= w / w1;\n    }\n\n    if (h1 != h) {\n      ex.min.y *= w / h1;\n      ex.max.y *= w / h1;\n    }\n\n    cv = null;\n    return ex;\n  }\n\n  function FixFont(f) {\n    return \"'\" + f.replace(/(\\'|\\\")/g, '').replace(/\\s*,\\s*/g, \"', '\") + \"'\";\n  }\n\n  function AddHandler(h, f, e) {\n    e = e || doc;\n    if (e.addEventListener) e.addEventListener(h, f, false);else e.attachEvent('on' + h, f);\n  }\n\n  function RemoveHandler(h, f, e) {\n    e = e || doc;\n    if (e.removeEventListener) e.removeEventListener(h, f);else e.detachEvent('on' + h, f);\n  }\n\n  function AddImage(i, o, t, tc) {\n    var s = tc.imageScale,\n        mscale,\n        ic,\n        bc,\n        oc,\n        iw,\n        ih; // image not loaded, wait for image onload\n\n    if (!o.complete) return AddHandler('load', function () {\n      AddImage(i, o, t, tc);\n    }, o);\n    if (!i.complete) return AddHandler('load', function () {\n      AddImage(i, o, t, tc);\n    }, i); // Yes, this does look like nonsense, but it makes sure that both the\n    // width and height are actually set and not just calculated. This is\n    // required to keep proportional sizes when the images are hidden, so\n    // the images can be used again for another cloud.\n\n    o.width = o.width;\n    o.height = o.height;\n\n    if (s) {\n      i.width = o.width * s;\n      i.height = o.height * s;\n    } // the standard width of the image, with imageScale applied\n\n\n    t.iw = i.width;\n    t.ih = i.height;\n\n    if (tc.txtOpt) {\n      ic = i;\n      mscale = tc.zoomMax * tc.txtScale;\n      iw = t.iw * mscale;\n      ih = t.ih * mscale;\n\n      if (iw < o.naturalWidth || ih < o.naturalHeight) {\n        ic = ScaleImage(i, iw, ih);\n        if (ic) t.fimage = ic;\n      } else {\n        iw = t.iw;\n        ih = t.ih;\n        mscale = 1;\n      }\n\n      if (parseFloat(tc.imageRadius)) t.image = t.fimage = i = RoundImage(t.image, tc.imageRadius, iw, ih, mscale);\n\n      if (!t.HasText()) {\n        if (tc.shadow) {\n          ic = AddShadowToImage(t.image, iw, ih, mscale, tc.shadow, tc.shadowBlur, tc.shadowOffset);\n\n          if (ic) {\n            t.fimage = ic.image;\n            t.w = ic.width;\n            t.h = ic.height;\n          }\n        }\n\n        if (tc.bgColour || tc.bgOutlineThickness) {\n          bc = tc.bgColour == 'tag' ? GetProperty(t.a, 'background-color') : tc.bgColour;\n          oc = tc.bgOutline == 'tag' ? GetProperty(t.a, 'color') : tc.bgOutline || tc.textColour;\n          iw = t.fimage.width;\n          ih = t.fimage.height;\n\n          if (tc.outlineMethod == 'colour') {\n            // create the outline version first, using the current image state\n            ic = AddBackgroundToImage(t.fimage, iw, ih, mscale, bc, tc.bgOutlineThickness, t.outline.colour, tc.padding, tc.bgRadius, 1);\n            if (ic) t.oimage = ic.image;\n          }\n\n          ic = AddBackgroundToImage(t.fimage, iw, ih, mscale, bc, tc.bgOutlineThickness, oc, tc.padding, tc.bgRadius);\n\n          if (ic) {\n            t.fimage = ic.image;\n            t.w = ic.width;\n            t.h = ic.height;\n          }\n        }\n\n        if (tc.outlineMethod == 'size') {\n          if (tc.outlineIncrease > 0) {\n            t.iw += 2 * tc.outlineIncrease;\n            t.ih += 2 * tc.outlineIncrease;\n            iw = mscale * t.iw;\n            ih = mscale * t.ih;\n            ic = ScaleImage(t.fimage, iw, ih);\n            t.oimage = ic;\n            t.fimage = ExpandImage(t.fimage, t.oimage.width, t.oimage.height);\n          } else {\n            iw = mscale * (t.iw + 2 * tc.outlineIncrease);\n            ih = mscale * (t.ih + 2 * tc.outlineIncrease);\n            ic = ScaleImage(t.fimage, iw, ih);\n            t.oimage = ExpandImage(ic, t.fimage.width, t.fimage.height);\n          }\n        }\n      }\n    }\n\n    t.Init();\n  }\n\n  function GetProperty(e, p) {\n    var dv = doc.defaultView,\n        pc = p.replace(/\\-([a-z])/g, function (a) {\n      return a.charAt(1).toUpperCase();\n    });\n    return dv && dv.getComputedStyle && dv.getComputedStyle(e, null).getPropertyValue(p) || e.currentStyle && e.currentStyle[pc];\n  }\n\n  function FindWeight(a, wFrom, tHeight) {\n    var w = 1,\n        p;\n\n    if (wFrom) {\n      w = 1 * (a.getAttribute(wFrom) || tHeight);\n    } else if (p = GetProperty(a, 'font-size')) {\n      w = p.indexOf('px') > -1 && p.replace('px', '') * 1 || p.indexOf('pt') > -1 && p.replace('pt', '') * 1.25 || p * 3.3;\n    }\n\n    return w;\n  }\n\n  function EventToCanvasId(e) {\n    return e.target && Defined(e.target.id) ? e.target.id : e.srcElement.parentNode.id;\n  }\n\n  function EventXY(e, c) {\n    var xy,\n        p,\n        xmul = parseInt(GetProperty(c, 'width')) / c.width,\n        ymul = parseInt(GetProperty(c, 'height')) / c.height;\n\n    if (Defined(e.offsetX)) {\n      xy = {\n        x: e.offsetX,\n        y: e.offsetY\n      };\n    } else {\n      p = AbsPos(c.id);\n      if (Defined(e.changedTouches)) e = e.changedTouches[0];\n      if (e.pageX) xy = {\n        x: e.pageX - p.x,\n        y: e.pageY - p.y\n      };\n    }\n\n    if (xy && xmul && ymul) {\n      xy.x /= xmul;\n      xy.y /= ymul;\n    }\n\n    return xy;\n  }\n\n  function MouseOut(e) {\n    var cv = e.target || e.fromElement.parentNode,\n        tc = TagCanvas.tc[cv.id];\n\n    if (tc) {\n      tc.mx = tc.my = -1;\n      tc.UnFreeze();\n      tc.EndDrag();\n    }\n  }\n\n  function MouseMove(e) {\n    var i,\n        t = TagCanvas,\n        tc,\n        p,\n        tg = EventToCanvasId(e);\n\n    for (i in t.tc) {\n      tc = t.tc[i];\n\n      if (tc.tttimer) {\n        clearTimeout(tc.tttimer);\n        tc.tttimer = null;\n      }\n    }\n\n    if (tg && t.tc[tg]) {\n      tc = t.tc[tg];\n\n      if (p = EventXY(e, tc.canvas)) {\n        tc.mx = p.x;\n        tc.my = p.y;\n        tc.Drag(e, p);\n      }\n\n      tc.drawn = 0;\n    }\n  }\n\n  function MouseDown(e) {\n    var t = TagCanvas,\n        cb = doc.addEventListener ? 0 : 1,\n        tg = EventToCanvasId(e);\n\n    if (tg && e.button == cb && t.tc[tg]) {\n      t.tc[tg].BeginDrag(e);\n    }\n  }\n\n  function MouseUp(e) {\n    var t = TagCanvas,\n        cb = doc.addEventListener ? 0 : 1,\n        tg = EventToCanvasId(e),\n        tc;\n\n    if (tg && e.button == cb && t.tc[tg]) {\n      tc = t.tc[tg];\n      MouseMove(e);\n      if (!tc.EndDrag() && !tc.touchState) tc.Clicked(e);\n    }\n  }\n\n  function TouchDown(e) {\n    var tg = EventToCanvasId(e),\n        tc = tg && TagCanvas.tc[tg],\n        p;\n\n    if (tc && e.changedTouches) {\n      if (e.touches.length == 1 && tc.touchState == 0) {\n        tc.touchState = 1;\n        tc.BeginDrag(e);\n\n        if (p = EventXY(e, tc.canvas)) {\n          tc.mx = p.x;\n          tc.my = p.y;\n          tc.drawn = 0;\n        }\n      } else if (e.targetTouches.length == 2 && tc.pinchZoom) {\n        tc.touchState = 3;\n        tc.EndDrag();\n        tc.BeginPinch(e);\n      } else {\n        tc.EndDrag();\n        tc.EndPinch();\n        tc.touchState = 0;\n      }\n    }\n  }\n\n  function TouchUp(e) {\n    var tg = EventToCanvasId(e),\n        tc = tg && TagCanvas.tc[tg];\n\n    if (tc && e.changedTouches) {\n      switch (tc.touchState) {\n        case 1:\n          tc.Draw();\n          tc.Clicked();\n          break;\n\n        case 2:\n          tc.EndDrag();\n          break;\n\n        case 3:\n          tc.EndPinch();\n      }\n\n      tc.touchState = 0;\n    }\n  }\n\n  function TouchMove(e) {\n    var i,\n        t = TagCanvas,\n        tc,\n        p,\n        tg = EventToCanvasId(e);\n\n    for (i in t.tc) {\n      tc = t.tc[i];\n\n      if (tc.tttimer) {\n        clearTimeout(tc.tttimer);\n        tc.tttimer = null;\n      }\n    }\n\n    tc = tg && t.tc[tg];\n\n    if (tc && e.changedTouches && tc.touchState) {\n      switch (tc.touchState) {\n        case 1:\n        case 2:\n          if (p = EventXY(e, tc.canvas)) {\n            tc.mx = p.x;\n            tc.my = p.y;\n            if (tc.Drag(e, p)) tc.touchState = 2;\n          }\n\n          break;\n\n        case 3:\n          tc.Pinch(e);\n      }\n\n      tc.drawn = 0;\n    }\n  }\n\n  function MouseWheel(e) {\n    var t = TagCanvas,\n        tg = EventToCanvasId(e);\n\n    if (tg && t.tc[tg]) {\n      e.cancelBubble = true;\n      e.returnValue = false;\n      e.preventDefault && e.preventDefault();\n      t.tc[tg].Wheel((e.wheelDelta || e.detail) > 0);\n    }\n  }\n\n  function Scroll(e) {\n    var i,\n        t = TagCanvas;\n    clearTimeout(t.scrollTimer);\n\n    for (i in t.tc) {\n      t.tc[i].Pause();\n    }\n\n    t.scrollTimer = setTimeout(function () {\n      var i,\n          t = TagCanvas;\n\n      for (i in t.tc) {\n        t.tc[i].Resume();\n      }\n    }, t.scrollPause);\n  }\n\n  function DrawCanvas() {\n    DrawCanvasRAF(TimeNow());\n  }\n\n  function DrawCanvasRAF(t) {\n    var tc = TagCanvas.tc,\n        i;\n    TagCanvas.NextFrame(TagCanvas.interval);\n    t = t || TimeNow();\n\n    for (i in tc) tc[i].Draw(t);\n  }\n\n  function AbsPos(id) {\n    var e = doc.getElementById(id),\n        r = e.getBoundingClientRect(),\n        dd = doc.documentElement,\n        b = doc.body,\n        w = window,\n        xs = w.pageXOffset || dd.scrollLeft,\n        ys = w.pageYOffset || dd.scrollTop,\n        xo = dd.clientLeft || b.clientLeft,\n        yo = dd.clientTop || b.clientTop;\n    return {\n      x: r.left + xs - xo,\n      y: r.top + ys - yo\n    };\n  }\n\n  function Project(tc, p1, sx, sy) {\n    var m = tc.radius * tc.z1 / (tc.z1 + tc.z2 + p1.z);\n    return {\n      x: p1.x * m * sx,\n      y: p1.y * m * sy,\n      z: p1.z,\n      w: (tc.z1 - p1.z) / tc.z2\n    };\n  }\n  /**\n   * @constructor\n   * for recursively splitting tag contents on <br> tags\n   */\n\n\n  function TextSplitter(e) {\n    this.e = e;\n    this.br = 0;\n    this.line = [];\n    this.text = [];\n    this.original = e.innerText || e.textContent;\n  }\n\n  TSproto = TextSplitter.prototype;\n\n  TSproto.Empty = function () {\n    for (var i = 0; i < this.text.length; ++i) if (this.text[i].length) return false;\n\n    return true;\n  };\n\n  TSproto.Lines = function (e) {\n    var r = e ? 1 : 0,\n        cn,\n        cl,\n        i;\n    e = e || this.e;\n    cn = e.childNodes;\n    cl = cn.length;\n\n    for (i = 0; i < cl; ++i) {\n      if (cn[i].nodeName == 'BR') {\n        this.text.push(this.line.join(' '));\n        this.br = 1;\n      } else if (cn[i].nodeType == 3) {\n        if (this.br) {\n          this.line = [cn[i].nodeValue];\n          this.br = 0;\n        } else {\n          this.line.push(cn[i].nodeValue);\n        }\n      } else {\n        this.Lines(cn[i]);\n      }\n    }\n\n    r || this.br || this.text.push(this.line.join(' '));\n    return this.text;\n  };\n\n  TSproto.SplitWidth = function (w, c, f, h) {\n    var i,\n        j,\n        words,\n        text = [];\n    c.font = h + 'px ' + f;\n\n    for (i = 0; i < this.text.length; ++i) {\n      words = this.text[i].split(/\\s+/);\n      this.line = [words[0]];\n\n      for (j = 1; j < words.length; ++j) {\n        if (c.measureText(this.line.join(' ') + ' ' + words[j]).width > w) {\n          text.push(this.line.join(' '));\n          this.line = [words[j]];\n        } else {\n          this.line.push(words[j]);\n        }\n      }\n\n      text.push(this.line.join(' '));\n    }\n\n    return this.text = text;\n  };\n  /**\n   * @constructor\n   */\n\n\n  function Outline(tc, t) {\n    this.ts = null;\n    this.tc = tc;\n    this.tag = t;\n    this.x = this.y = this.w = this.h = this.sc = 1;\n    this.z = 0;\n    this.pulse = 1;\n    this.pulsate = tc.pulsateTo < 1;\n    this.colour = tc.outlineColour;\n    this.adash = ~~tc.outlineDash;\n    this.agap = ~~tc.outlineDashSpace || this.adash;\n    this.aspeed = tc.outlineDashSpeed * 1;\n    if (this.colour == 'tag') this.colour = GetProperty(t.a, 'color');else if (this.colour == 'tagbg') this.colour = GetProperty(t.a, 'background-color');\n    this.Draw = this.pulsate ? this.DrawPulsate : this.DrawSimple;\n    this.radius = tc.outlineRadius | 0;\n    this.SetMethod(tc.outlineMethod);\n  }\n\n  Oproto = Outline.prototype;\n\n  Oproto.SetMethod = function (om) {\n    var methods = {\n      block: ['PreDraw', 'DrawBlock'],\n      colour: ['PreDraw', 'DrawColour'],\n      outline: ['PostDraw', 'DrawOutline'],\n      classic: ['LastDraw', 'DrawOutline'],\n      size: ['PreDraw', 'DrawSize'],\n      none: ['LastDraw']\n    },\n        funcs = methods[om] || methods.outline;\n\n    if (om == 'none') {\n      this.Draw = function () {\n        return 1;\n      };\n    } else {\n      this.drawFunc = this[funcs[1]];\n    }\n\n    this[funcs[0]] = this.Draw;\n  };\n\n  Oproto.Update = function (x, y, w, h, sc, z, xo, yo) {\n    var o = this.tc.outlineOffset,\n        o2 = 2 * o;\n    this.x = sc * x + xo - o;\n    this.y = sc * y + yo - o;\n    this.w = sc * w + o2;\n    this.h = sc * h + o2;\n    this.sc = sc; // used to determine frontmost\n\n    this.z = z;\n  };\n\n  Oproto.Ants = function (c) {\n    if (!this.adash) return;\n    var l = this.adash,\n        g = this.agap,\n        s = this.aspeed,\n        length = l + g,\n        l1 = 0,\n        l2 = l,\n        g1 = g,\n        g2 = 0,\n        seq = 0,\n        ants;\n\n    if (s) {\n      seq = abs(s) * (TimeNow() - this.ts) / 50;\n      if (s < 0) seq = 8.64e6 - seq;\n      s = ~~seq % length;\n    }\n\n    if (s) {\n      if (l >= s) {\n        l1 = l - s;\n        l2 = s;\n      } else {\n        g1 = length - s;\n        g2 = g - g1;\n      }\n\n      ants = [l1, g1, l2, g2];\n    } else {\n      ants = [l, g];\n    }\n\n    c.setLineDash(ants);\n  };\n\n  Oproto.DrawOutline = function (c, x, y, w, h, colour) {\n    var r = min(this.radius, h / 2, w / 2);\n    c.strokeStyle = colour;\n    this.Ants(c);\n    RRect(c, x, y, w, h, r, true);\n  };\n\n  Oproto.DrawSize = function (c, x, y, w, h, colour, tag, x1, y1) {\n    var tw = tag.w,\n        th = tag.h,\n        m,\n        i,\n        sc;\n\n    if (this.pulsate) {\n      if (tag.image) sc = (tag.image.height + this.tc.outlineIncrease) / tag.image.height;else sc = tag.oscale;\n      i = tag.fimage || tag.image;\n      m = 1 + (sc - 1) * (1 - this.pulse);\n      tag.h *= m;\n      tag.w *= m;\n    } else {\n      i = tag.oimage;\n    }\n\n    tag.alpha = 1;\n    tag.Draw(c, x1, y1, i);\n    tag.h = th;\n    tag.w = tw;\n    return 1;\n  };\n\n  Oproto.DrawColour = function (c, x, y, w, h, colour, tag, x1, y1) {\n    if (tag.oimage) {\n      if (this.pulse < 1) {\n        tag.alpha = 1 - pow(this.pulse, 2);\n        tag.Draw(c, x1, y1, tag.fimage);\n        tag.alpha = this.pulse;\n      } else {\n        tag.alpha = 1;\n      }\n\n      tag.Draw(c, x1, y1, tag.oimage);\n      return 1;\n    }\n\n    return this[tag.image ? 'DrawColourImage' : 'DrawColourText'](c, x, y, w, h, colour, tag, x1, y1);\n  };\n\n  Oproto.DrawColourText = function (c, x, y, w, h, colour, tag, x1, y1) {\n    var normal = tag.colour;\n    tag.colour = colour;\n    tag.alpha = 1;\n    tag.Draw(c, x1, y1);\n    tag.colour = normal;\n    return 1;\n  };\n\n  Oproto.DrawColourImage = function (c, x, y, w, h, colour, tag, x1, y1) {\n    var ccanvas = c.canvas,\n        fx = ~~max(x, 0),\n        fy = ~~max(y, 0),\n        fw = min(ccanvas.width - fx, w) + .5 | 0,\n        fh = min(ccanvas.height - fy, h) + .5 | 0,\n        cc;\n    if (ocanvas) ocanvas.width = fw, ocanvas.height = fh;else ocanvas = NewCanvas(fw, fh);\n    if (!ocanvas) return this.SetMethod('outline'); // if using IE and images, give up!\n\n    cc = ocanvas.getContext('2d');\n    cc.drawImage(ccanvas, fx, fy, fw, fh, 0, 0, fw, fh);\n    c.clearRect(fx, fy, fw, fh);\n\n    if (this.pulsate) {\n      tag.alpha = 1 - pow(this.pulse, 2);\n    } else {\n      tag.alpha = 1;\n    }\n\n    tag.Draw(c, x1, y1);\n    c.setTransform(1, 0, 0, 1, 0, 0);\n    c.save();\n    c.beginPath();\n    c.rect(fx, fy, fw, fh);\n    c.clip();\n    c.globalCompositeOperation = 'source-in';\n    c.fillStyle = colour;\n    c.fillRect(fx, fy, fw, fh);\n    c.restore();\n    c.globalAlpha = 1;\n    c.globalCompositeOperation = 'destination-over';\n    c.drawImage(ocanvas, 0, 0, fw, fh, fx, fy, fw, fh);\n    c.globalCompositeOperation = 'source-over';\n    return 1;\n  };\n\n  Oproto.DrawBlock = function (c, x, y, w, h, colour) {\n    var r = min(this.radius, h / 2, w / 2);\n    c.fillStyle = colour;\n    RRect(c, x, y, w, h, r);\n  };\n\n  Oproto.DrawSimple = function (c, tag, x1, y1, ga, useGa) {\n    var t = this.tc;\n    c.setTransform(1, 0, 0, 1, 0, 0);\n    c.strokeStyle = this.colour;\n    c.lineWidth = t.outlineThickness;\n    c.shadowBlur = c.shadowOffsetX = c.shadowOffsetY = 0;\n    c.globalAlpha = useGa ? ga : 1;\n    return this.drawFunc(c, this.x, this.y, this.w, this.h, this.colour, tag, x1, y1);\n  };\n\n  Oproto.DrawPulsate = function (c, tag, x1, y1) {\n    var diff = TimeNow() - this.ts,\n        t = this.tc,\n        ga = t.pulsateTo + (1 - t.pulsateTo) * (0.5 + cos(2 * Math.PI * diff / (1000 * t.pulsateTime)) / 2);\n    this.pulse = ga = TagCanvas.Smooth(1, ga);\n    return this.DrawSimple(c, tag, x1, y1, ga, 1);\n  };\n\n  Oproto.Active = function (c, x, y) {\n    var a = x >= this.x && y >= this.y && x <= this.x + this.w && y <= this.y + this.h;\n\n    if (a) {\n      this.ts = this.ts || TimeNow();\n    } else {\n      this.ts = null;\n    }\n\n    return a;\n  };\n\n  Oproto.PreDraw = Oproto.PostDraw = Oproto.LastDraw = Nop;\n  /**\n   * @constructor\n   */\n\n  function Tag(tc, text, a, v, w, h, col, bcol, bradius, boutline, bothickness, font, padding, original) {\n    this.tc = tc;\n    this.image = null;\n    this.text = text;\n    this.text_original = original;\n    this.line_widths = [];\n    this.title = a.title || null;\n    this.a = a;\n    this.position = new Vector(v[0], v[1], v[2]);\n    this.x = this.y = this.z = 0;\n    this.w = w;\n    this.h = h;\n    this.colour = col || tc.textColour;\n    this.bgColour = bcol || tc.bgColour;\n    this.bgRadius = bradius | 0;\n    this.bgOutline = boutline || this.colour;\n    this.bgOutlineThickness = bothickness | 0;\n    this.textFont = font || tc.textFont;\n    this.padding = padding | 0;\n    this.sc = this.alpha = 1;\n    this.weighted = !tc.weight;\n    this.outline = new Outline(tc, this);\n  }\n\n  Tproto = Tag.prototype;\n\n  Tproto.Init = function (e) {\n    var tc = this.tc;\n    this.textHeight = tc.textHeight;\n\n    if (this.HasText()) {\n      this.Measure(tc.ctxt, tc);\n    } else {\n      this.w = this.iw;\n      this.h = this.ih;\n    }\n\n    this.SetShadowColour = tc.shadowAlpha ? this.SetShadowColourAlpha : this.SetShadowColourFixed;\n    this.SetDraw(tc);\n  };\n\n  Tproto.Draw = Nop;\n\n  Tproto.HasText = function () {\n    return this.text && this.text[0].length > 0;\n  };\n\n  Tproto.EqualTo = function (e) {\n    var i = e.getElementsByTagName('img');\n    if (this.a.href != e.href) return 0;\n    if (i.length) return this.image.src == i[0].src;\n    return (e.innerText || e.textContent) == this.text_original;\n  };\n\n  Tproto.SetImage = function (i) {\n    this.image = this.fimage = i;\n  };\n\n  Tproto.SetDraw = function (t) {\n    this.Draw = this.fimage ? t.ie > 7 ? this.DrawImageIE : this.DrawImage : this.DrawText;\n    t.noSelect && (this.CheckActive = Nop);\n  };\n\n  Tproto.MeasureText = function (c) {\n    var i,\n        l = this.text.length,\n        w = 0,\n        wl;\n\n    for (i = 0; i < l; ++i) {\n      this.line_widths[i] = wl = c.measureText(this.text[i]).width;\n      w = max(w, wl);\n    }\n\n    return w;\n  };\n\n  Tproto.Measure = function (c, t) {\n    var extents = FindTextBoundingBox(this.text, this.textFont, this.textHeight),\n        s,\n        th,\n        f,\n        soff,\n        cw,\n        twidth,\n        theight,\n        img,\n        tcv; // add the gap at the top to the height to make equal gap at bottom\n\n    theight = extents ? extents.max.y + extents.min.y : this.textHeight;\n    c.font = this.font = this.textHeight + 'px ' + this.textFont;\n    twidth = this.MeasureText(c);\n\n    if (t.txtOpt) {\n      s = t.txtScale;\n      th = s * this.textHeight;\n      f = th + 'px ' + this.textFont;\n      soff = [s * t.shadowOffset[0], s * t.shadowOffset[1]];\n      c.font = f;\n      cw = this.MeasureText(c);\n      tcv = new TextCanvas(this.text, f, cw + s, s * theight + s, cw, this.line_widths, t.textAlign, t.textVAlign, s);\n      if (this.image) tcv.SetImage(this.image, this.iw, this.ih, t.imagePosition, t.imagePadding, t.imageAlign, t.imageVAlign, t.imageScale);\n      img = tcv.Create(this.colour, this.bgColour, this.bgOutline, s * this.bgOutlineThickness, t.shadow, s * t.shadowBlur, soff, s * this.padding, s * this.bgRadius); // add outline image using highlight colour\n\n      if (t.outlineMethod == 'colour') {\n        this.oimage = tcv.Create(this.outline.colour, this.bgColour, this.outline.colour, s * this.bgOutlineThickness, t.shadow, s * t.shadowBlur, soff, s * this.padding, s * this.bgRadius);\n      } else if (t.outlineMethod == 'size') {\n        extents = FindTextBoundingBox(this.text, this.textFont, this.textHeight + t.outlineIncrease);\n        th = extents.max.y + extents.min.y;\n        f = s * (this.textHeight + t.outlineIncrease) + 'px ' + this.textFont;\n        c.font = f;\n        cw = this.MeasureText(c);\n        tcv = new TextCanvas(this.text, f, cw + s, s * th + s, cw, this.line_widths, t.textAlign, t.textVAlign, s);\n        if (this.image) tcv.SetImage(this.image, this.iw + t.outlineIncrease, this.ih + t.outlineIncrease, t.imagePosition, t.imagePadding, t.imageAlign, t.imageVAlign, t.imageScale);\n        this.oimage = tcv.Create(this.colour, this.bgColour, this.bgOutline, s * this.bgOutlineThickness, t.shadow, s * t.shadowBlur, soff, s * this.padding, s * this.bgRadius);\n        this.oscale = this.oimage.width / img.width;\n        if (t.outlineIncrease > 0) img = ExpandImage(img, this.oimage.width, this.oimage.height);else this.oimage = ExpandImage(this.oimage, img.width, img.height);\n      }\n\n      if (img) {\n        this.fimage = img;\n        twidth = this.fimage.width / s;\n        theight = this.fimage.height / s;\n      }\n\n      this.SetDraw(t);\n      t.txtOpt = !!this.fimage;\n    }\n\n    this.h = theight;\n    this.w = twidth;\n  };\n\n  Tproto.SetFont = function (f, c, bc, boc) {\n    this.textFont = f;\n    this.colour = c;\n    this.bgColour = bc;\n    this.bgOutline = boc;\n    this.Measure(this.tc.ctxt, this.tc);\n  };\n\n  Tproto.SetWeight = function (w) {\n    var tc = this.tc,\n        modes = tc.weightMode.split(/[, ]/),\n        m,\n        s,\n        wl = w.length;\n    if (!this.HasText()) return;\n    this.weighted = true;\n\n    for (s = 0; s < wl; ++s) {\n      m = modes[s] || 'size';\n\n      if ('both' == m) {\n        this.Weight(w[s], tc.ctxt, tc, 'size', tc.min_weight[s], tc.max_weight[s], s);\n        this.Weight(w[s], tc.ctxt, tc, 'colour', tc.min_weight[s], tc.max_weight[s], s);\n      } else {\n        this.Weight(w[s], tc.ctxt, tc, m, tc.min_weight[s], tc.max_weight[s], s);\n      }\n    }\n\n    this.Measure(tc.ctxt, tc);\n  };\n\n  Tproto.Weight = function (w, c, t, m, wmin, wmax, wnum) {\n    w = isNaN(w) ? 1 : w;\n    var nweight = (w - wmin) / (wmax - wmin);\n    if ('colour' == m) this.colour = FindGradientColour(t, nweight, wnum);else if ('bgcolour' == m) this.bgColour = FindGradientColour(t, nweight, wnum);else if ('bgoutline' == m) this.bgOutline = FindGradientColour(t, nweight, wnum);else if ('outline' == m) this.outline.colour = FindGradientColour(t, nweight, wnum);else if ('size' == m) {\n      if (t.weightSizeMin > 0 && t.weightSizeMax > t.weightSizeMin) {\n        this.textHeight = t.weightSize * (t.weightSizeMin + (t.weightSizeMax - t.weightSizeMin) * nweight);\n      } else {\n        // min textHeight of 1\n        this.textHeight = max(1, w * t.weightSize);\n      }\n    }\n  };\n\n  Tproto.SetShadowColourFixed = function (c, s, a) {\n    c.shadowColor = s;\n  };\n\n  Tproto.SetShadowColourAlpha = function (c, s, a) {\n    c.shadowColor = SetAlpha(s, a);\n  };\n\n  Tproto.DrawText = function (c, xoff, yoff) {\n    var t = this.tc,\n        x = this.x,\n        y = this.y,\n        s = this.sc,\n        i,\n        xl;\n    c.globalAlpha = this.alpha;\n    c.fillStyle = this.colour;\n    t.shadow && this.SetShadowColour(c, t.shadow, this.alpha);\n    c.font = this.font;\n    x += xoff / s;\n    y += yoff / s - this.h / 2;\n\n    for (i = 0; i < this.text.length; ++i) {\n      xl = x;\n\n      if ('right' == t.textAlign) {\n        xl += this.w / 2 - this.line_widths[i];\n      } else if ('centre' == t.textAlign) {\n        xl -= this.line_widths[i] / 2;\n      } else {\n        xl -= this.w / 2;\n      }\n\n      c.setTransform(s, 0, 0, s, s * xl, s * y);\n      c.fillText(this.text[i], 0, 0);\n      y += this.textHeight;\n    }\n  };\n\n  Tproto.DrawImage = function (c, xoff, yoff, im) {\n    var x = this.x,\n        y = this.y,\n        s = this.sc,\n        i = im || this.fimage,\n        w = this.w,\n        h = this.h,\n        a = this.alpha,\n        shadow = this.shadow;\n    c.globalAlpha = a;\n    shadow && this.SetShadowColour(c, shadow, a);\n    x += xoff / s - w / 2;\n    y += yoff / s - h / 2;\n    c.setTransform(s, 0, 0, s, s * x, s * y);\n    c.drawImage(i, 0, 0, w, h);\n  };\n\n  Tproto.DrawImageIE = function (c, xoff, yoff) {\n    var i = this.fimage,\n        s = this.sc,\n        w = i.width = this.w * s,\n        h = i.height = this.h * s,\n        x = this.x * s + xoff - w / 2,\n        y = this.y * s + yoff - h / 2;\n    c.setTransform(1, 0, 0, 1, 0, 0);\n    c.globalAlpha = this.alpha;\n    c.drawImage(i, x, y);\n  };\n\n  Tproto.Calc = function (m, a) {\n    var pp,\n        t = this.tc,\n        mnb = t.minBrightness,\n        mxb = t.maxBrightness,\n        r = t.max_radius;\n    pp = m.xform(this.position);\n    this.xformed = pp;\n    pp = Project(t, pp, t.stretchX, t.stretchY);\n    this.x = pp.x;\n    this.y = pp.y;\n    this.z = pp.z;\n    this.sc = pp.w;\n    this.alpha = a * Clamp(mnb + (mxb - mnb) * (r - this.z) / (2 * r), 0, 1);\n    return this.xformed;\n  };\n\n  Tproto.UpdateActive = function (c, xoff, yoff) {\n    var o = this.outline,\n        w = this.w,\n        h = this.h,\n        x = this.x - w / 2,\n        y = this.y - h / 2;\n    o.Update(x, y, w, h, this.sc, this.z, xoff, yoff);\n    return o;\n  };\n\n  Tproto.CheckActive = function (c, xoff, yoff) {\n    var t = this.tc,\n        o = this.UpdateActive(c, xoff, yoff);\n    return o.Active(c, t.mx, t.my) ? o : null;\n  };\n\n  Tproto.Clicked = function (e) {\n    var a = this.a,\n        t = a.target,\n        h = a.href,\n        evt;\n\n    if (t != '' && t != '_self') {\n      if (self.frames[t]) {\n        self.frames[t].document.location = h;\n      } else {\n        try {\n          if (top.frames[t]) {\n            top.frames[t].document.location = h;\n            return;\n          }\n        } catch (err) {// different domain/port/protocol?\n        }\n\n        window.open(h, t);\n      }\n\n      return;\n    }\n\n    if (doc.createEvent) {\n      evt = doc.createEvent('MouseEvents');\n      evt.initMouseEvent('click', 1, 1, window, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, null);\n      if (!a.dispatchEvent(evt)) return;\n    } else if (a.fireEvent) {\n      if (!a.fireEvent('onclick')) return;\n    }\n\n    doc.location = h;\n  };\n  /**\n   * @constructor\n   */\n\n\n  function TagCanvas(cid, lctr, opt) {\n    var i,\n        p,\n        c = doc.getElementById(cid),\n        cp = ['id', 'class', 'innerHTML'],\n        raf;\n    if (!c) throw 0;\n\n    if (Defined(window.G_vmlCanvasManager)) {\n      c = window.G_vmlCanvasManager.initElement(c);\n      this.ie = parseFloat(navigator.appVersion.split('MSIE')[1]);\n    }\n\n    if (c && (!c.getContext || !c.getContext('2d').fillText)) {\n      p = doc.createElement('DIV');\n\n      for (i = 0; i < cp.length; ++i) p[cp[i]] = c[cp[i]];\n\n      c.parentNode.insertBefore(p, c);\n      c.parentNode.removeChild(c);\n      throw 0;\n    }\n\n    for (i in TagCanvas.options) this[i] = opt && Defined(opt[i]) ? opt[i] : Defined(TagCanvas[i]) ? TagCanvas[i] : TagCanvas.options[i];\n\n    this.canvas = c;\n    this.ctxt = c.getContext('2d');\n    this.z1 = 250 / max(this.depth, 0.001);\n    this.z2 = this.z1 / this.zoom;\n    this.radius = min(c.height, c.width) * 0.0075; // fits radius of 100 in canvas\n\n    this.max_radius = 100;\n    this.max_weight = [];\n    this.min_weight = [];\n    this.textFont = this.textFont && FixFont(this.textFont);\n    this.textHeight *= 1;\n    this.imageRadius = this.imageRadius.toString();\n    this.pulsateTo = Clamp(this.pulsateTo, 0, 1);\n    this.minBrightness = Clamp(this.minBrightness, 0, 1);\n    this.maxBrightness = Clamp(this.maxBrightness, this.minBrightness, 1);\n    this.ctxt.textBaseline = 'top';\n    this.lx = (this.lock + '').indexOf('x') + 1;\n    this.ly = (this.lock + '').indexOf('y') + 1;\n    this.frozen = this.dx = this.dy = this.fixedAnim = this.touchState = 0;\n    this.fixedAlpha = 1;\n    this.source = lctr || cid;\n    this.repeatTags = min(64, ~~this.repeatTags);\n    this.minTags = min(200, ~~this.minTags);\n    if (~~this.scrollPause > 0) TagCanvas.scrollPause = ~~this.scrollPause;else this.scrollPause = 0;\n    if (this.minTags > 0 && this.repeatTags < 1 && (i = this.GetTags().length)) this.repeatTags = ceil(this.minTags / i) - 1;\n    this.transform = Matrix.Identity();\n    this.startTime = this.time = TimeNow();\n    this.mx = this.my = -1;\n    this.centreImage && CentreImage(this);\n    this.Animate = this.dragControl ? this.AnimateDrag : this.AnimatePosition;\n    this.animTiming = typeof TagCanvas[this.animTiming] == 'function' ? TagCanvas[this.animTiming] : TagCanvas.Smooth;\n\n    if (this.shadowBlur || this.shadowOffset[0] || this.shadowOffset[1]) {\n      // let the browser translate \"red\" into \"#ff0000\"\n      this.ctxt.shadowColor = this.shadow;\n      this.shadow = this.ctxt.shadowColor;\n      this.shadowAlpha = ShadowAlphaBroken();\n    } else {\n      delete this.shadow;\n    }\n\n    this.Load();\n\n    if (lctr && this.hideTags) {\n      (function (t) {\n        if (TagCanvas.loaded) t.HideTags();else AddHandler('load', function () {\n          t.HideTags();\n        }, window);\n      })(this);\n    }\n\n    this.yaw = this.initial ? this.initial[0] * this.maxSpeed : 0;\n    this.pitch = this.initial ? this.initial[1] * this.maxSpeed : 0;\n\n    if (this.tooltip) {\n      this.ctitle = c.title;\n      c.title = '';\n\n      if (this.tooltip == 'native') {\n        this.Tooltip = this.TooltipNative;\n      } else {\n        this.Tooltip = this.TooltipDiv;\n\n        if (!this.ttdiv) {\n          this.ttdiv = doc.createElement('div');\n          this.ttdiv.className = this.tooltipClass;\n          this.ttdiv.style.position = 'absolute';\n          this.ttdiv.style.zIndex = c.style.zIndex + 1;\n          AddHandler('mouseover', function (e) {\n            e.target.style.display = 'none';\n          }, this.ttdiv);\n          doc.body.appendChild(this.ttdiv);\n        }\n      }\n    } else {\n      this.Tooltip = this.TooltipNone;\n    }\n\n    if (!this.noMouse && !handlers[cid]) {\n      handlers[cid] = [['mousemove', MouseMove], ['mouseout', MouseOut], ['mouseup', MouseUp], ['touchstart', TouchDown], ['touchend', TouchUp], ['touchcancel', TouchUp], ['touchmove', TouchMove]];\n\n      if (this.dragControl) {\n        handlers[cid].push(['mousedown', MouseDown]);\n        handlers[cid].push(['selectstart', Nop]);\n      }\n\n      if (this.wheelZoom) {\n        handlers[cid].push(['mousewheel', MouseWheel]);\n        handlers[cid].push(['DOMMouseScroll', MouseWheel]);\n      }\n\n      if (this.scrollPause) {\n        handlers[cid].push(['scroll', Scroll, window]);\n      }\n\n      for (i = 0; i < handlers[cid].length; ++i) {\n        p = handlers[cid][i];\n        AddHandler(p[0], p[1], p[2] ? p[2] : c);\n      }\n    }\n\n    if (!TagCanvas.started) {\n      raf = window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;\n      TagCanvas.NextFrame = raf ? TagCanvas.NextFrameRAF : TagCanvas.NextFrameTimeout;\n      TagCanvas.interval = this.interval;\n      TagCanvas.NextFrame(this.interval);\n      TagCanvas.started = 1;\n    }\n  }\n\n  TCproto = TagCanvas.prototype;\n\n  TCproto.SourceElements = function () {\n    if (doc.querySelectorAll) return doc.querySelectorAll('#' + this.source);\n    return [doc.getElementById(this.source)];\n  };\n\n  TCproto.HideTags = function () {\n    var el = this.SourceElements(),\n        i;\n\n    for (i = 0; i < el.length; ++i) el[i].style.display = 'none';\n  };\n\n  TCproto.GetTags = function () {\n    var el = this.SourceElements(),\n        etl,\n        tl = [],\n        i,\n        j,\n        k;\n\n    for (k = 0; k <= this.repeatTags; ++k) {\n      for (i = 0; i < el.length; ++i) {\n        etl = el[i].getElementsByTagName('a');\n\n        for (j = 0; j < etl.length; ++j) {\n          tl.push(etl[j]);\n        }\n      }\n    }\n\n    return tl;\n  };\n\n  TCproto.Message = function (text) {\n    var tl = [],\n        i,\n        p,\n        tc = text.split(''),\n        a,\n        t,\n        x,\n        z;\n\n    for (i = 0; i < tc.length; ++i) {\n      if (tc[i] != ' ') {\n        p = i - tc.length / 2;\n        a = doc.createElement('A');\n        a.href = '#';\n        a.innerText = tc[i];\n        x = 100 * sin(p / 9);\n        z = -100 * cos(p / 9);\n        t = new Tag(this, tc[i], a, [x, 0, z], 2, 18, '#000', '#fff', 0, 0, 0, 'monospace', 2, tc[i]);\n        t.Init();\n        tl.push(t);\n      }\n    }\n\n    return tl;\n  };\n\n  TCproto.CreateTag = function (e) {\n    var im,\n        i,\n        t,\n        txt,\n        ts,\n        font,\n        bc,\n        boc,\n        p = [0, 0, 0];\n\n    if ('text' != this.imageMode) {\n      im = e.getElementsByTagName('img');\n\n      if (im.length) {\n        i = new Image();\n        i.src = im[0].src;\n\n        if (!this.imageMode) {\n          t = new Tag(this, \"\", e, p, 0, 0);\n          t.SetImage(i); //t.Init();\n\n          AddImage(i, im[0], t, this);\n          return t;\n        }\n      }\n    }\n\n    if ('image' != this.imageMode) {\n      ts = new TextSplitter(e);\n      txt = ts.Lines();\n\n      if (!ts.Empty()) {\n        font = this.textFont || FixFont(GetProperty(e, 'font-family'));\n        if (this.splitWidth) txt = ts.SplitWidth(this.splitWidth, this.ctxt, font, this.textHeight);\n        bc = this.bgColour == 'tag' ? GetProperty(e, 'background-color') : this.bgColour;\n        boc = this.bgOutline == 'tag' ? GetProperty(e, 'color') : this.bgOutline;\n      } else {\n        ts = null;\n      }\n    }\n\n    if (ts || i) {\n      t = new Tag(this, txt, e, p, 2, this.textHeight + 2, this.textColour || GetProperty(e, 'color'), bc, this.bgRadius, boc, this.bgOutlineThickness, font, this.padding, ts && ts.original);\n\n      if (i) {\n        t.SetImage(i);\n        AddImage(i, im[0], t, this);\n      } else {\n        t.Init();\n      }\n\n      return t;\n    }\n  };\n\n  TCproto.UpdateTag = function (t, a) {\n    var colour = this.textColour || GetProperty(a, 'color'),\n        font = this.textFont || FixFont(GetProperty(a, 'font-family')),\n        bc = this.bgColour == 'tag' ? GetProperty(a, 'background-color') : this.bgColour,\n        boc = this.bgOutline == 'tag' ? GetProperty(a, 'color') : this.bgOutline;\n    t.a = a;\n    t.title = a.title;\n    if (t.colour != colour || t.textFont != font || t.bgColour != bc || t.bgOutline != boc) t.SetFont(font, colour, bc, boc);\n  };\n\n  TCproto.Weight = function (tl) {\n    var ll = tl.length,\n        w,\n        i,\n        s,\n        weights = [],\n        valid,\n        wfrom = this.weightFrom ? this.weightFrom.split(/[, ]/) : [null],\n        wl = wfrom.length;\n\n    for (i = 0; i < ll; ++i) {\n      weights[i] = [];\n\n      for (s = 0; s < wl; ++s) {\n        w = FindWeight(tl[i].a, wfrom[s], this.textHeight);\n        if (!this.max_weight[s] || w > this.max_weight[s]) this.max_weight[s] = w;\n        if (!this.min_weight[s] || w < this.min_weight[s]) this.min_weight[s] = w;\n        weights[i][s] = w;\n      }\n    }\n\n    for (s = 0; s < wl; ++s) {\n      if (this.max_weight[s] > this.min_weight[s]) valid = 1;\n    }\n\n    if (valid) {\n      for (i = 0; i < ll; ++i) {\n        tl[i].SetWeight(weights[i]);\n      }\n    }\n  };\n\n  TCproto.Load = function () {\n    var tl = this.GetTags(),\n        taglist = [],\n        shape,\n        t,\n        shapeArgs,\n        rx,\n        ry,\n        rz,\n        vl,\n        i,\n        tagmap = [],\n        pfuncs = {\n      sphere: PointsOnSphere,\n      vcylinder: PointsOnCylinderV,\n      hcylinder: PointsOnCylinderH,\n      vring: PointsOnRingV,\n      hring: PointsOnRingH\n    };\n\n    if (tl.length) {\n      tagmap.length = tl.length;\n\n      for (i = 0; i < tl.length; ++i) tagmap[i] = i;\n\n      this.shuffleTags && Shuffle(tagmap);\n      rx = 100 * this.radiusX;\n      ry = 100 * this.radiusY;\n      rz = 100 * this.radiusZ;\n      this.max_radius = max(rx, max(ry, rz));\n\n      for (i = 0; i < tl.length; ++i) {\n        t = this.CreateTag(tl[tagmap[i]]);\n        if (t) taglist.push(t);\n      }\n\n      this.weight && this.Weight(taglist, true);\n\n      if (this.shapeArgs) {\n        this.shapeArgs[0] = taglist.length;\n      } else {\n        shapeArgs = this.shape.toString().split(/[(),]/);\n        shape = shapeArgs.shift();\n        if (typeof window[shape] === 'function') this.shape = window[shape];else this.shape = pfuncs[shape] || pfuncs.sphere;\n        this.shapeArgs = [taglist.length, rx, ry, rz].concat(shapeArgs);\n      }\n\n      vl = this.shape.apply(this, this.shapeArgs);\n      this.listLength = taglist.length;\n\n      for (i = 0; i < taglist.length; ++i) taglist[i].position = new Vector(vl[i][0], vl[i][1], vl[i][2]);\n    }\n\n    if (this.noTagsMessage && !taglist.length) {\n      i = this.imageMode && this.imageMode != 'both' ? this.imageMode + ' ' : '';\n      taglist = this.Message('No ' + i + 'tags');\n    }\n\n    this.taglist = taglist;\n  };\n\n  TCproto.Update = function () {\n    var tl = this.GetTags(),\n        newlist = [],\n        taglist = this.taglist,\n        found,\n        added = [],\n        removed = [],\n        vl,\n        ol,\n        nl,\n        i,\n        j;\n    if (!this.shapeArgs) return this.Load();\n\n    if (tl.length) {\n      nl = this.listLength = tl.length;\n      ol = taglist.length; // copy existing list, populate \"removed\"\n\n      for (i = 0; i < ol; ++i) {\n        newlist.push(taglist[i]);\n        removed.push(i);\n      } // find added and removed tags\n\n\n      for (i = 0; i < nl; ++i) {\n        for (j = 0, found = 0; j < ol; ++j) {\n          if (taglist[j].EqualTo(tl[i])) {\n            this.UpdateTag(newlist[j], tl[i]);\n            found = removed[j] = -1;\n          }\n        }\n\n        if (!found) added.push(i);\n      } // clean out found tags from removed list\n\n\n      for (i = 0, j = 0; i < ol; ++i) {\n        if (removed[j] == -1) removed.splice(j, 1);else ++j;\n      } // insert new tags in gaps where old tags removed\n\n\n      if (removed.length) {\n        Shuffle(removed);\n\n        while (removed.length && added.length) {\n          i = removed.shift();\n          j = added.shift();\n          newlist[i] = this.CreateTag(tl[j]);\n        } // remove any more (in reverse order)\n\n\n        removed.sort(function (a, b) {\n          return a - b;\n        });\n\n        while (removed.length) {\n          newlist.splice(removed.pop(), 1);\n        }\n      } // add any extra tags\n\n\n      j = newlist.length / (added.length + 1);\n      i = 0;\n\n      while (added.length) {\n        newlist.splice(ceil(++i * j), 0, this.CreateTag(tl[added.shift()]));\n      } // assign correct positions to tags\n\n\n      this.shapeArgs[0] = nl = newlist.length;\n      vl = this.shape.apply(this, this.shapeArgs);\n\n      for (i = 0; i < nl; ++i) newlist[i].position = new Vector(vl[i][0], vl[i][1], vl[i][2]); // reweight tags\n\n\n      this.weight && this.Weight(newlist);\n    }\n\n    this.taglist = newlist;\n  };\n\n  TCproto.SetShadow = function (c) {\n    c.shadowBlur = this.shadowBlur;\n    c.shadowOffsetX = this.shadowOffset[0];\n    c.shadowOffsetY = this.shadowOffset[1];\n  };\n\n  TCproto.Draw = function (t) {\n    if (this.paused) return;\n    var cv = this.canvas,\n        cw = cv.width,\n        ch = cv.height,\n        max_sc = 0,\n        tdelta = (t - this.time) * TagCanvas.interval / 1000,\n        x = cw / 2 + this.offsetX,\n        y = ch / 2 + this.offsetY,\n        c = this.ctxt,\n        active,\n        a,\n        i,\n        aindex = -1,\n        tl = this.taglist,\n        l = tl.length,\n        frontsel = this.frontSelect,\n        centreDrawn = this.centreFunc == Nop,\n        fixed;\n    this.time = t;\n    if (this.frozen && this.drawn) return this.Animate(cw, ch, tdelta);\n    fixed = this.AnimateFixed();\n    c.setTransform(1, 0, 0, 1, 0, 0);\n\n    for (i = 0; i < l; ++i) tl[i].Calc(this.transform, this.fixedAlpha);\n\n    tl = SortList(tl, function (a, b) {\n      return b.z - a.z;\n    });\n\n    if (fixed && this.fixedAnim.active) {\n      active = this.fixedAnim.tag.UpdateActive(c, x, y);\n    } else {\n      this.active = null;\n\n      for (i = 0; i < l; ++i) {\n        a = this.mx >= 0 && this.my >= 0 && this.taglist[i].CheckActive(c, x, y);\n\n        if (a && a.sc > max_sc && (!frontsel || a.z <= 0)) {\n          active = a;\n          aindex = i;\n          active.tag = this.taglist[i];\n          max_sc = a.sc;\n        }\n      }\n\n      this.active = active;\n    }\n\n    this.txtOpt || this.shadow && this.SetShadow(c);\n    c.clearRect(0, 0, cw, ch);\n\n    for (i = 0; i < l; ++i) {\n      if (!centreDrawn && tl[i].z <= 0) {\n        // run the centreFunc if the next tag is at the front\n        try {\n          this.centreFunc(c, cw, ch, x, y);\n        } catch (e) {\n          alert(e); // don't run it again\n\n          this.centreFunc = Nop;\n        }\n\n        centreDrawn = true;\n      }\n\n      if (!(active && active.tag == tl[i] && active.PreDraw(c, tl[i], x, y))) tl[i].Draw(c, x, y);\n      active && active.tag == tl[i] && active.PostDraw(c);\n    }\n\n    if (this.freezeActive && active) {\n      this.Freeze();\n    } else {\n      this.UnFreeze();\n      this.drawn = l == this.listLength;\n    }\n\n    if (this.fixedCallback) {\n      this.fixedCallback(this, this.fixedCallbackTag);\n      this.fixedCallback = null;\n    }\n\n    fixed || this.Animate(cw, ch, tdelta);\n    active && active.LastDraw(c);\n    cv.style.cursor = active ? this.activeCursor : '';\n    this.Tooltip(active, this.taglist[aindex]);\n  };\n\n  TCproto.TooltipNone = function () {};\n\n  TCproto.TooltipNative = function (active, tag) {\n    if (active) this.canvas.title = tag && tag.title ? tag.title : '';else this.canvas.title = this.ctitle;\n  };\n\n  TCproto.SetTTDiv = function (title, tag) {\n    var tc = this,\n        s = tc.ttdiv.style;\n    if (title != tc.ttdiv.innerHTML) s.display = 'none';\n    tc.ttdiv.innerHTML = title;\n    tag && (tag.title = tc.ttdiv.innerHTML);\n\n    if (s.display == 'none' && !tc.tttimer) {\n      tc.tttimer = setTimeout(function () {\n        var p = AbsPos(tc.canvas.id);\n        s.display = 'block';\n        s.left = p.x + tc.mx + 'px';\n        s.top = p.y + tc.my + 24 + 'px';\n        tc.tttimer = null;\n      }, tc.tooltipDelay);\n    }\n  };\n\n  TCproto.TooltipDiv = function (active, tag) {\n    if (active && tag && tag.title) {\n      this.SetTTDiv(tag.title, tag);\n    } else if (!active && this.mx != -1 && this.my != -1 && this.ctitle.length) {\n      this.SetTTDiv(this.ctitle);\n    } else {\n      this.ttdiv.style.display = 'none';\n    }\n  };\n\n  TCproto.Transform = function (tc, p, y) {\n    if (p || y) {\n      var sp = sin(p),\n          cp = cos(p),\n          sy = sin(y),\n          cy = cos(y),\n          ym = new Matrix([cy, 0, sy, 0, 1, 0, -sy, 0, cy]),\n          pm = new Matrix([1, 0, 0, 0, cp, -sp, 0, sp, cp]);\n      tc.transform = tc.transform.mul(ym.mul(pm));\n    }\n  };\n\n  TCproto.AnimateFixed = function () {\n    var fa, t1, angle, m, d;\n\n    if (this.fadeIn) {\n      t1 = TimeNow() - this.startTime;\n\n      if (t1 >= this.fadeIn) {\n        this.fadeIn = 0;\n        this.fixedAlpha = 1;\n      } else {\n        this.fixedAlpha = t1 / this.fadeIn;\n      }\n    }\n\n    if (this.fixedAnim) {\n      if (!this.fixedAnim.transform) this.fixedAnim.transform = this.transform;\n      fa = this.fixedAnim, t1 = TimeNow() - fa.t0, angle = fa.angle, m, d = this.animTiming(fa.t, t1);\n      this.transform = fa.transform;\n\n      if (t1 >= fa.t) {\n        this.fixedCallbackTag = fa.tag;\n        this.fixedCallback = fa.cb;\n        this.fixedAnim = this.yaw = this.pitch = 0;\n      } else {\n        angle *= d;\n      }\n\n      m = Matrix.Rotation(angle, fa.axis);\n      this.transform = this.transform.mul(m);\n      return this.fixedAnim != 0;\n    }\n\n    return false;\n  };\n\n  TCproto.AnimatePosition = function (w, h, t) {\n    var tc = this,\n        x = tc.mx,\n        y = tc.my,\n        s,\n        r;\n\n    if (!tc.frozen && x >= 0 && y >= 0 && x < w && y < h) {\n      s = tc.maxSpeed, r = tc.reverse ? -1 : 1;\n      tc.lx || (tc.yaw = (x * 2 * s / w - s) * r * t);\n      tc.ly || (tc.pitch = (y * 2 * s / h - s) * -r * t);\n      tc.initial = null;\n    } else if (!tc.initial) {\n      if (tc.frozen && !tc.freezeDecel) tc.yaw = tc.pitch = 0;else tc.Decel(tc);\n    }\n\n    this.Transform(tc, tc.pitch, tc.yaw);\n  };\n\n  TCproto.AnimateDrag = function (w, h, t) {\n    var tc = this,\n        rs = 100 * t * tc.maxSpeed / tc.max_radius / tc.zoom;\n\n    if (tc.dx || tc.dy) {\n      tc.lx || (tc.yaw = tc.dx * rs / tc.stretchX);\n      tc.ly || (tc.pitch = tc.dy * -rs / tc.stretchY);\n      tc.dx = tc.dy = 0;\n      tc.initial = null;\n    } else if (!tc.initial) {\n      tc.Decel(tc);\n    }\n\n    this.Transform(tc, tc.pitch, tc.yaw);\n  };\n\n  TCproto.Freeze = function () {\n    if (!this.frozen) {\n      this.preFreeze = [this.yaw, this.pitch];\n      this.frozen = 1;\n      this.drawn = 0;\n    }\n  };\n\n  TCproto.UnFreeze = function () {\n    if (this.frozen) {\n      this.yaw = this.preFreeze[0];\n      this.pitch = this.preFreeze[1];\n      this.frozen = 0;\n    }\n  };\n\n  TCproto.Decel = function (tc) {\n    var s = tc.minSpeed,\n        ay = abs(tc.yaw),\n        ap = abs(tc.pitch);\n    if (!tc.lx && ay > s) tc.yaw = ay > tc.z0 ? tc.yaw * tc.decel : 0;\n    if (!tc.ly && ap > s) tc.pitch = ap > tc.z0 ? tc.pitch * tc.decel : 0;\n  };\n\n  TCproto.Zoom = function (r) {\n    this.z2 = this.z1 * (1 / r);\n    this.drawn = 0;\n  };\n\n  TCproto.Clicked = function (e) {\n    var a = this.active;\n\n    try {\n      if (a && a.tag) if (this.clickToFront === false || this.clickToFront === null) a.tag.Clicked(e);else this.TagToFront(a.tag, this.clickToFront, function () {\n        a.tag.Clicked(e);\n      }, true);\n    } catch (ex) {}\n  };\n\n  TCproto.Wheel = function (i) {\n    var z = this.zoom + this.zoomStep * (i ? 1 : -1);\n    this.zoom = min(this.zoomMax, max(this.zoomMin, z));\n    this.Zoom(this.zoom);\n  };\n\n  TCproto.BeginDrag = function (e) {\n    this.down = EventXY(e, this.canvas);\n    e.cancelBubble = true;\n    e.returnValue = false;\n    e.preventDefault && e.preventDefault();\n  };\n\n  TCproto.Drag = function (e, p) {\n    if (this.dragControl && this.down) {\n      var t2 = this.dragThreshold * this.dragThreshold,\n          dx = p.x - this.down.x,\n          dy = p.y - this.down.y;\n\n      if (this.dragging || dx * dx + dy * dy > t2) {\n        this.dx = dx;\n        this.dy = dy;\n        this.dragging = 1;\n        this.down = p;\n      }\n    }\n\n    return this.dragging;\n  };\n\n  TCproto.EndDrag = function () {\n    var res = this.dragging;\n    this.dragging = this.down = null;\n    return res;\n  };\n\n  function PinchDistance(e) {\n    var t1 = e.targetTouches[0],\n        t2 = e.targetTouches[1];\n    return sqrt(pow(t2.pageX - t1.pageX, 2) + pow(t2.pageY - t1.pageY, 2));\n  }\n\n  TCproto.BeginPinch = function (e) {\n    this.pinched = [PinchDistance(e), this.zoom];\n    e.preventDefault && e.preventDefault();\n  };\n\n  TCproto.Pinch = function (e) {\n    var z,\n        d,\n        p = this.pinched;\n    if (!p) return;\n    d = PinchDistance(e);\n    z = p[1] * d / p[0];\n    this.zoom = min(this.zoomMax, max(this.zoomMin, z));\n    this.Zoom(this.zoom);\n  };\n\n  TCproto.EndPinch = function (e) {\n    this.pinched = null;\n  };\n\n  TCproto.Pause = function () {\n    this.paused = true;\n  };\n\n  TCproto.Resume = function () {\n    this.paused = false;\n  };\n\n  TCproto.SetSpeed = function (i) {\n    this.initial = i;\n    this.yaw = i[0] * this.maxSpeed;\n    this.pitch = i[1] * this.maxSpeed;\n  };\n\n  TCproto.FindTag = function (t) {\n    if (!Defined(t)) return null;\n    Defined(t.index) && (t = t.index);\n    if (!IsObject(t)) return this.taglist[t];\n    var srch, tgt, i;\n    if (Defined(t.id)) srch = 'id', tgt = t.id;else if (Defined(t.text)) srch = 'innerText', tgt = t.text;\n\n    for (i = 0; i < this.taglist.length; ++i) if (this.taglist[i].a[srch] == tgt) return this.taglist[i];\n  };\n\n  TCproto.RotateTag = function (tag, lt, lg, time, callback, active) {\n    var t = tag.Calc(this.transform, 1),\n        v1 = new Vector(t.x, t.y, t.z),\n        v2 = MakeVector(lg, lt),\n        angle = v1.angle(v2),\n        u = v1.cross(v2).unit();\n\n    if (angle == 0) {\n      this.fixedCallbackTag = tag;\n      this.fixedCallback = callback;\n    } else {\n      this.fixedAnim = {\n        angle: -angle,\n        axis: u,\n        t: time,\n        t0: TimeNow(),\n        cb: callback,\n        tag: tag,\n        active: active\n      };\n    }\n  };\n\n  TCproto.TagToFront = function (tag, time, callback, active) {\n    this.RotateTag(tag, 0, 0, time, callback, active);\n  };\n\n  TagCanvas.Start = function (id, l, o) {\n    TagCanvas.Delete(id);\n    TagCanvas.tc[id] = new TagCanvas(id, l, o);\n  };\n\n  function tccall(f, id) {\n    TagCanvas.tc[id] && TagCanvas.tc[id][f]();\n  }\n\n  TagCanvas.Linear = function (t, t0) {\n    return t0 / t;\n  };\n\n  TagCanvas.Smooth = function (t, t0) {\n    return 0.5 - cos(t0 * Math.PI / t) / 2;\n  };\n\n  TagCanvas.Pause = function (id) {\n    tccall('Pause', id);\n  };\n\n  TagCanvas.Resume = function (id) {\n    tccall('Resume', id);\n  };\n\n  TagCanvas.Reload = function (id) {\n    tccall('Load', id);\n  };\n\n  TagCanvas.Update = function (id) {\n    tccall('Update', id);\n  };\n\n  TagCanvas.SetSpeed = function (id, speed) {\n    if (IsObject(speed) && TagCanvas.tc[id] && !isNaN(speed[0]) && !isNaN(speed[1])) {\n      TagCanvas.tc[id].SetSpeed(speed);\n      return true;\n    }\n\n    return false;\n  };\n\n  TagCanvas.TagToFront = function (id, options) {\n    if (!IsObject(options)) return false;\n    options.lat = options.lng = 0;\n    return TagCanvas.RotateTag(id, options);\n  };\n\n  TagCanvas.RotateTag = function (id, options) {\n    if (IsObject(options) && TagCanvas.tc[id]) {\n      if (isNaN(options.time)) options.time = 500;\n      var tt = TagCanvas.tc[id].FindTag(options);\n\n      if (tt) {\n        TagCanvas.tc[id].RotateTag(tt, options.lat, options.lng, options.time, options.callback, options.active);\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  TagCanvas.Delete = function (id) {\n    var i, c;\n\n    if (handlers[id]) {\n      c = doc.getElementById(id);\n\n      if (c) {\n        for (i = 0; i < handlers[id].length; ++i) RemoveHandler(handlers[id][i][0], handlers[id][i][1], c);\n      }\n    }\n\n    delete handlers[id];\n    delete TagCanvas.tc[id];\n  };\n\n  TagCanvas.NextFrameRAF = function () {\n    requestAnimationFrame(DrawCanvasRAF);\n  };\n\n  TagCanvas.NextFrameTimeout = function (iv) {\n    setTimeout(DrawCanvas, iv);\n  };\n\n  TagCanvas.tc = {};\n  TagCanvas.options = {\n    z1: 20000,\n    z2: 20000,\n    z0: 0.0002,\n    freezeActive: false,\n    freezeDecel: false,\n    activeCursor: 'pointer',\n    pulsateTo: 1,\n    pulsateTime: 3,\n    reverse: false,\n    depth: 0.5,\n    maxSpeed: 0.05,\n    minSpeed: 0,\n    decel: 0.95,\n    interval: 20,\n    minBrightness: 0.1,\n    maxBrightness: 1,\n    outlineColour: '#ffff99',\n    outlineThickness: 2,\n    outlineOffset: 5,\n    outlineMethod: 'outline',\n    outlineRadius: 0,\n    textColour: '#ff99ff',\n    textHeight: 15,\n    textFont: 'Helvetica, Arial, sans-serif',\n    shadow: '#000',\n    shadowBlur: 0,\n    shadowOffset: [0, 0],\n    initial: null,\n    hideTags: true,\n    zoom: 1,\n    weight: false,\n    weightMode: 'size',\n    weightFrom: null,\n    weightSize: 1,\n    weightSizeMin: null,\n    weightSizeMax: null,\n    weightGradient: {\n      0: '#f00',\n      0.33: '#ff0',\n      0.66: '#0f0',\n      1: '#00f'\n    },\n    txtOpt: true,\n    txtScale: 2,\n    frontSelect: false,\n    wheelZoom: true,\n    zoomMin: 0.3,\n    zoomMax: 3,\n    zoomStep: 0.05,\n    shape: 'sphere',\n    lock: null,\n    tooltip: null,\n    tooltipDelay: 300,\n    tooltipClass: 'tctooltip',\n    radiusX: 1,\n    radiusY: 1,\n    radiusZ: 1,\n    stretchX: 1,\n    stretchY: 1,\n    offsetX: 0,\n    offsetY: 0,\n    shuffleTags: false,\n    noSelect: false,\n    noMouse: false,\n    imageScale: 1,\n    paused: false,\n    dragControl: false,\n    dragThreshold: 4,\n    centreFunc: Nop,\n    splitWidth: 0,\n    animTiming: 'Smooth',\n    clickToFront: false,\n    fadeIn: 0,\n    padding: 0,\n    bgColour: null,\n    bgRadius: 0,\n    bgOutline: null,\n    bgOutlineThickness: 0,\n    outlineIncrease: 4,\n    textAlign: 'centre',\n    textVAlign: 'middle',\n    imageMode: null,\n    imagePosition: null,\n    imagePadding: 2,\n    imageAlign: 'centre',\n    imageVAlign: 'middle',\n    noTagsMessage: true,\n    centreImage: null,\n    pinchZoom: false,\n    repeatTags: 0,\n    minTags: 0,\n    imageRadius: 0,\n    scrollPause: false,\n    outlineDash: 0,\n    outlineDashSpace: 0,\n    outlineDashSpeed: 1\n  };\n\n  for (i in TagCanvas.options) TagCanvas[i] = TagCanvas.options[i];\n\n  window.TagCanvas = TagCanvas; // set a flag for when the window has loaded\n\n  AddHandler('load', function () {\n    TagCanvas.loaded = 1;\n  }, window);\n})();","map":{"version":3,"names":["i","j","abs","Math","sin","cos","max","min","ceil","sqrt","pow","hexlookup3","hexlookup2","hexlookup1","a","A","b","B","c","C","d","D","e","E","f","F","Oproto","Tproto","TCproto","Mproto","Vproto","TSproto","TCVproto","doc","document","ocanvas","handlers","toString","toUpperCase","Defined","IsObject","o","Clamp","v","mn","mx","isNaN","Nop","TimeNow","Date","valueOf","SortList","l","nl","tl","length","push","sort","Shuffle","t","p","random","Vector","x","y","z","prototype","dot","cross","angle","ac","PI","acos","unit","MakeVector","lg","lt","Matrix","Identity","Rotation","u","sina","cosa","mcos","mul","m","mmatrix","xform","PointsOnSphere","n","xr","yr","zr","magic","r","phi","pts","off","inc","parseFloat","Cylinder","k","Ring","PointsOnCylinderV","PointsOnCylinderH","PointsOnRingV","offset","PointsOnRingH","CentreImage","Image","onload","dx","width","dy","height","centreFunc","w","h","cx","cy","setTransform","globalAlpha","drawImage","src","centreImage","SetAlpha","p1","p2","ae","toPrecision","substr","replace","lastIndexOf","indexOf","substring","NewCanvas","window","G_vmlCanvasManager","createElement","ShadowAlphaBroken","cv","getContext","strokeStyle","shadowColor","shadowBlur","strokeRect","getImageData","data","SetGradient","g","gd","createLinearGradient","addColorStop","fillStyle","fillRect","FindGradientColour","tc","gl","weightGradient","gCanvas","TextSet","ctxt","font","colour","strings","padx","pady","shadowColour","shadowOffsets","maxWidth","widths","align","xo","yo","xc","textBaseline","shadowOffsetX","shadowOffsetY","fillText","parseInt","RRect","s","beginPath","moveTo","arcTo","closePath","TextCanvas","stringWidths","valign","scale","SetImage","image","position","padding","iwidth","iheight","ipos","ipad","iscale","ialign","ivalign","Align","size","space","pos","Create","bgColour","bgOutline","bgOutlineThickness","radius","cw","ch","x1","x2","y1","y2","offx","offy","ix","iy","iw","ih","rr","sox","soy","shadowcv","shadowc","lineWidth","ExpandImage","ScaleImage","AddBackgroundToImage","othickness","ocolour","ofill","cc","globalCompositeOperation","RoundImage","r1","arc","fill","AddShadowToImage","sc","sb","so","sw","sh","FindTextBoundingBox","ht","idata","w1","h1","ex","FixFont","AddHandler","addEventListener","attachEvent","RemoveHandler","removeEventListener","detachEvent","AddImage","imageScale","mscale","ic","bc","oc","complete","txtOpt","zoomMax","txtScale","naturalWidth","naturalHeight","fimage","imageRadius","HasText","shadow","shadowOffset","GetProperty","textColour","outlineMethod","outline","bgRadius","oimage","outlineIncrease","Init","dv","defaultView","pc","charAt","getComputedStyle","getPropertyValue","currentStyle","FindWeight","wFrom","tHeight","getAttribute","EventToCanvasId","target","id","srcElement","parentNode","EventXY","xy","xmul","ymul","offsetX","offsetY","AbsPos","changedTouches","pageX","pageY","MouseOut","fromElement","TagCanvas","my","UnFreeze","EndDrag","MouseMove","tg","tttimer","clearTimeout","canvas","Drag","drawn","MouseDown","cb","button","BeginDrag","MouseUp","touchState","Clicked","TouchDown","touches","targetTouches","pinchZoom","BeginPinch","EndPinch","TouchUp","Draw","TouchMove","Pinch","MouseWheel","cancelBubble","returnValue","preventDefault","Wheel","wheelDelta","detail","Scroll","scrollTimer","Pause","setTimeout","Resume","scrollPause","DrawCanvas","DrawCanvasRAF","NextFrame","interval","getElementById","getBoundingClientRect","dd","documentElement","body","xs","pageXOffset","scrollLeft","ys","pageYOffset","scrollTop","clientLeft","clientTop","left","top","Project","sx","sy","z1","z2","TextSplitter","br","line","text","original","innerText","textContent","Empty","Lines","cn","cl","childNodes","nodeName","join","nodeType","nodeValue","SplitWidth","words","split","measureText","Outline","ts","tag","pulse","pulsate","pulsateTo","outlineColour","adash","outlineDash","agap","outlineDashSpace","aspeed","outlineDashSpeed","DrawPulsate","DrawSimple","outlineRadius","SetMethod","om","methods","block","classic","none","funcs","drawFunc","Update","outlineOffset","o2","Ants","l1","l2","g1","g2","seq","ants","setLineDash","DrawOutline","DrawSize","tw","th","oscale","alpha","DrawColour","DrawColourText","normal","DrawColourImage","ccanvas","fx","fy","fw","fh","clearRect","save","rect","clip","restore","DrawBlock","ga","useGa","outlineThickness","diff","pulsateTime","Smooth","Active","PreDraw","PostDraw","LastDraw","Tag","col","bcol","bradius","boutline","bothickness","text_original","line_widths","title","textFont","weighted","weight","textHeight","Measure","SetShadowColour","shadowAlpha","SetShadowColourAlpha","SetShadowColourFixed","SetDraw","EqualTo","getElementsByTagName","href","ie","DrawImageIE","DrawImage","DrawText","noSelect","CheckActive","MeasureText","wl","extents","soff","twidth","theight","img","tcv","textAlign","textVAlign","imagePosition","imagePadding","imageAlign","imageVAlign","SetFont","boc","SetWeight","modes","weightMode","Weight","min_weight","max_weight","wmin","wmax","wnum","nweight","weightSizeMin","weightSizeMax","weightSize","xoff","yoff","xl","im","Calc","pp","mnb","minBrightness","mxb","maxBrightness","max_radius","xformed","stretchX","stretchY","UpdateActive","evt","self","frames","location","err","open","createEvent","initMouseEvent","dispatchEvent","fireEvent","cid","lctr","opt","cp","raf","initElement","navigator","appVersion","insertBefore","removeChild","options","depth","zoom","lx","lock","ly","frozen","fixedAnim","fixedAlpha","source","repeatTags","minTags","GetTags","transform","startTime","time","Animate","dragControl","AnimateDrag","AnimatePosition","animTiming","Load","hideTags","loaded","HideTags","yaw","initial","maxSpeed","pitch","tooltip","ctitle","Tooltip","TooltipNative","TooltipDiv","ttdiv","className","tooltipClass","style","zIndex","display","appendChild","TooltipNone","noMouse","wheelZoom","started","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","NextFrameRAF","NextFrameTimeout","SourceElements","querySelectorAll","el","etl","Message","CreateTag","txt","imageMode","splitWidth","UpdateTag","ll","weights","valid","wfrom","weightFrom","taglist","shape","shapeArgs","rx","ry","rz","vl","tagmap","pfuncs","sphere","vcylinder","hcylinder","vring","hring","shuffleTags","radiusX","radiusY","radiusZ","shift","concat","apply","listLength","noTagsMessage","newlist","found","added","removed","ol","splice","pop","SetShadow","paused","max_sc","tdelta","active","aindex","frontsel","frontSelect","centreDrawn","fixed","AnimateFixed","alert","freezeActive","Freeze","fixedCallback","fixedCallbackTag","cursor","activeCursor","SetTTDiv","innerHTML","tooltipDelay","Transform","sp","ym","pm","fa","t1","fadeIn","t0","axis","reverse","freezeDecel","Decel","rs","preFreeze","minSpeed","ay","ap","z0","decel","Zoom","clickToFront","TagToFront","zoomStep","zoomMin","down","t2","dragThreshold","dragging","res","PinchDistance","pinched","SetSpeed","FindTag","index","srch","tgt","RotateTag","callback","v1","v2","Start","Delete","tccall","Linear","Reload","speed","lat","lng","tt","iv"],"sources":["C:/Users/saiprasad/Desktop/portfolio-A/node_modules/jquery-tagcanvas/tagcanvas.js"],"sourcesContent":["/**\n * Copyright (C) 2010-2015 Graham Breach\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n * \n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n/**\n * TagCanvas 2.9\n * For more information, please contact <graham@goat1000.com>\n */\n(function(){\n\"use strict\";\nvar i, j, abs = Math.abs, sin = Math.sin, cos = Math.cos, max = Math.max,\n  min = Math.min, ceil = Math.ceil, sqrt = Math.sqrt, pow = Math.pow,\n  hexlookup3 = {}, hexlookup2 = {}, hexlookup1 = {\n  0:\"0,\",   1:\"17,\",  2:\"34,\",  3:\"51,\",  4:\"68,\",  5:\"85,\",\n  6:\"102,\", 7:\"119,\", 8:\"136,\", 9:\"153,\", a:\"170,\", A:\"170,\",\n  b:\"187,\", B:\"187,\", c:\"204,\", C:\"204,\", d:\"221,\", D:\"221,\",\n  e:\"238,\", E:\"238,\", f:\"255,\", F:\"255,\"  \n  }, Oproto, Tproto, TCproto, Mproto, Vproto, TSproto, TCVproto,\n  doc = document, ocanvas, handlers = {};\nfor(i = 0; i < 256; ++i) {\n  j = i.toString(16);\n  if(i < 16)\n    j = '0' + j;\n  hexlookup2[j] = hexlookup2[j.toUpperCase()] = i.toString() + ',';\n}\nfunction Defined(d) {\n  return typeof d != 'undefined';\n}\nfunction IsObject(o) {\n  return typeof o == 'object' && o != null;\n}\nfunction Clamp(v, mn, mx) {\n  return isNaN(v) ? mx : min(mx, max(mn, v));\n}\nfunction Nop() {\n  return false;\n}\nfunction TimeNow() {\n  return new Date().valueOf();\n}\nfunction SortList(l, f) {\n  var nl = [], tl = l.length, i;\n  for(i = 0; i < tl; ++i)\n    nl.push(l[i]);\n  nl.sort(f);\n  return nl;\n}\nfunction Shuffle(a) {\n  var i = a.length-1, t, p;\n  while(i) {\n    p = ~~(Math.random()*i);\n    t = a[i];\n    a[i] = a[p];\n    a[p] = t;\n    --i;\n  }\n}\nfunction Vector(x, y, z) {\n  this.x = x;\n  this.y = y;\n  this.z = z;\n}\nVproto = Vector.prototype;\nVproto.length = function() {\n  return sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n};\nVproto.dot = function(v) {\n  return this.x * v.x + this.y * v.y + this.z * v.z;\n};\nVproto.cross = function(v) {\n  var x = this.y * v.z - this.z * v.y,\n    y = this.z * v.x - this.x * v.z,\n    z = this.x * v.y - this.y * v.x;\n  return new Vector(x, y, z);\n};\nVproto.angle = function(v) {\n  var dot = this.dot(v), ac;\n  if(dot == 0)\n    return Math.PI / 2.0;\n  ac = dot / (this.length() * v.length());\n  if(ac >= 1)\n    return 0;\n  if(ac <= -1)\n    return Math.PI;\n  return Math.acos(ac);\n};\nVproto.unit = function() {\n  var l = this.length();\n  return new Vector(this.x / l, this.y / l, this.z / l);\n};\nfunction MakeVector(lg, lt) {\n  lt = lt * Math.PI / 180;\n  lg = lg * Math.PI / 180;\n  var x = sin(lg) * cos(lt), y = -sin(lt), z = -cos(lg) * cos(lt);\n  return new Vector(x, y, z);\n}\nfunction Matrix(a) {\n  this[1] = {1: a[0],  2: a[1],  3: a[2]};\n  this[2] = {1: a[3],  2: a[4],  3: a[5]};\n  this[3] = {1: a[6],  2: a[7],  3: a[8]};\n}\nMproto = Matrix.prototype;\nMatrix.Identity = function() {\n  return new Matrix([1,0,0, 0,1,0, 0,0,1]);\n};\nMatrix.Rotation = function(angle, u) {\n  var sina = sin(angle), cosa = cos(angle), mcos = 1 - cosa;\n  return new Matrix([\n    cosa + pow(u.x, 2) * mcos, u.x * u.y * mcos - u.z * sina, u.x * u.z * mcos + u.y * sina,\n    u.y * u.x * mcos + u.z * sina, cosa + pow(u.y, 2) * mcos, u.y * u.z * mcos - u.x * sina,\n    u.z * u.x * mcos - u.y * sina, u.z * u.y * mcos + u.x * sina, cosa + pow(u.z, 2) * mcos\n  ]);\n}\nMproto.mul = function(m) {\n  var a = [], i, j, mmatrix = (m.xform ? 1 : 0);\n  for(i = 1; i <= 3; ++i)\n    for(j = 1; j <= 3; ++j) {\n      if(mmatrix)\n        a.push(this[i][1] * m[1][j] +\n          this[i][2] * m[2][j] +\n          this[i][3] * m[3][j]);\n      else\n        a.push(this[i][j] * m);\n    }\n  return new Matrix(a);\n};\nMproto.xform = function(p) {\n  var a = {}, x = p.x, y = p.y, z = p.z;\n  a.x = x * this[1][1] + y * this[2][1] + z * this[3][1];\n  a.y = x * this[1][2] + y * this[2][2] + z * this[3][2];\n  a.z = x * this[1][3] + y * this[2][3] + z * this[3][3];\n  return a;\n};\nfunction PointsOnSphere(n,xr,yr,zr,magic) {\n  var i, y, r, phi, pts = [], off = 2/n, inc;\n  inc = Math.PI * (3 - sqrt(5) + (parseFloat(magic) ? parseFloat(magic) : 0));\n  for(i = 0; i < n; ++i) {\n    y = i * off - 1 + (off / 2);\n    r = sqrt(1 - y*y);\n    phi = i * inc;\n    pts.push([cos(phi) * r * xr, y * yr, sin(phi) * r * zr]);\n  }\n  return pts;\n}\nfunction Cylinder(n,o,xr,yr,zr,magic) {\n  var phi, pts = [], off = 2/n, inc, i, j, k, l;\n  inc = Math.PI * (3 - sqrt(5) + (parseFloat(magic) ? parseFloat(magic) : 0));\n  for(i = 0; i < n; ++i) {\n    j = i * off - 1 + (off / 2);\n    phi = i * inc;\n    k = cos(phi);\n    l = sin(phi);\n    pts.push(o ? [j * xr, k * yr, l * zr] : [k * xr, j * yr, l * zr]);\n  }\n  return pts;\n}\nfunction Ring(o, n, xr, yr, zr, j) {\n  var phi, pts = [], inc = Math.PI * 2 / n, i, k, l;\n  for(i = 0; i < n; ++i) {\n    phi = i * inc;\n    k = cos(phi);\n    l = sin(phi);\n    pts.push(o ? [j * xr, k * yr, l * zr] : [k * xr, j * yr, l * zr]);\n  }\n  return pts;\n}\nfunction PointsOnCylinderV(n,xr,yr,zr,m) { return Cylinder(n, 0, xr, yr, zr, m) }\nfunction PointsOnCylinderH(n,xr,yr,zr,m) { return Cylinder(n, 1, xr, yr, zr, m) }\nfunction PointsOnRingV(n, xr, yr, zr, offset) {\n  offset = isNaN(offset) ? 0 : offset * 1;\n  return Ring(0, n, xr, yr, zr, offset);\n}\nfunction PointsOnRingH(n, xr, yr, zr, offset) {\n  offset = isNaN(offset) ? 0 : offset * 1;\n  return Ring(1, n, xr, yr, zr, offset);\n}\nfunction CentreImage(t) {\n  var i = new Image;\n  i.onload = function() {\n    var dx = i.width / 2, dy = i.height / 2;\n    t.centreFunc = function(c, w, h, cx, cy) {\n      c.setTransform(1, 0, 0, 1, 0, 0);\n      c.globalAlpha = 1;\n      c.drawImage(i, cx - dx, cy - dy);\n    };\n  };\n  i.src = t.centreImage;\n}\nfunction SetAlpha(c,a) {\n  var d = c, p1, p2, ae = (a*1).toPrecision(3) + ')';\n  if(c[0] === '#') {\n    if(!hexlookup3[c])\n      if(c.length === 4)\n        hexlookup3[c] = 'rgba(' + hexlookup1[c[1]] + hexlookup1[c[2]] + hexlookup1[c[3]];\n      else\n        hexlookup3[c] = 'rgba(' + hexlookup2[c.substr(1,2)] + hexlookup2[c.substr(3,2)] + hexlookup2[c.substr(5,2)];\n    d = hexlookup3[c] + ae;\n  } else if(c.substr(0,4) === 'rgb(' || c.substr(0,4) === 'hsl(') {\n    d = (c.replace('(','a(').replace(')', ',' + ae));\n  } else if(c.substr(0,5) === 'rgba(' || c.substr(0,5) === 'hsla(') {\n    p1 = c.lastIndexOf(',') + 1, p2 = c.indexOf(')');\n    a *= parseFloat(c.substring(p1,p2));\n    d = c.substr(0,p1) + a.toPrecision(3) + ')';\n  }\n  return d;\n}\nfunction NewCanvas(w,h) {\n  // if using excanvas, give up now\n  if(window.G_vmlCanvasManager)\n    return null;\n  var c = doc.createElement('canvas');\n  c.width = w;\n  c.height = h;\n  return c;\n}\n// I think all browsers pass this test now...\nfunction ShadowAlphaBroken() {\n  var cv = NewCanvas(3,3), c, i;\n  if(!cv)\n    return false;\n  c = cv.getContext('2d');\n  c.strokeStyle = '#000';\n  c.shadowColor = '#fff';\n  c.shadowBlur = 3;\n  c.globalAlpha = 0;\n  c.strokeRect(2,2,2,2);\n  c.globalAlpha = 1;\n  i = c.getImageData(2,2,1,1);\n  cv = null;\n  return (i.data[0] > 0);\n}\nfunction SetGradient(c, l, o, g) {\n  var gd = c.createLinearGradient(0, 0, l, 0), i;\n  for(i in g)\n    gd.addColorStop(1 - i, g[i]);\n  c.fillStyle = gd;\n  c.fillRect(0, o, l, 1);\n}\nfunction FindGradientColour(tc, p, r) {\n  var l = 1024, h = 1, gl = tc.weightGradient, cv, c, i, d;\n  if(tc.gCanvas) {\n    c = tc.gCanvas.getContext('2d');\n    h = tc.gCanvas.height;\n  } else {\n    if(IsObject(gl[0]))\n      h = gl.length;\n    else\n      gl = [gl];\n    tc.gCanvas = cv = NewCanvas(l, h);\n    if(!cv)\n      return null;\n    c = cv.getContext('2d');\n    for(i = 0; i < h; ++i)\n      SetGradient(c, l, i, gl[i]);\n  }\n  r = max(min(r || 0, h - 1), 0);\n  d = c.getImageData(~~((l - 1) * p), r, 1, 1).data;\n  return 'rgba(' + d[0] + ',' + d[1] + ',' + d[2] + ',' + (d[3]/255) + ')';\n}\nfunction TextSet(ctxt, font, colour, strings, padx, pady, shadowColour,\n  shadowBlur, shadowOffsets, maxWidth, widths, align) {\n  var xo = padx + (shadowBlur || 0) + \n    (shadowOffsets.length && shadowOffsets[0] < 0 ? abs(shadowOffsets[0]) : 0),\n    yo = pady + (shadowBlur || 0) + \n    (shadowOffsets.length && shadowOffsets[1] < 0 ? abs(shadowOffsets[1]) : 0), i, xc;\n  ctxt.font = font;\n  ctxt.textBaseline = 'top';\n  ctxt.fillStyle = colour;\n  shadowColour && (ctxt.shadowColor = shadowColour);\n  shadowBlur && (ctxt.shadowBlur = shadowBlur);\n  shadowOffsets.length && (ctxt.shadowOffsetX = shadowOffsets[0],\n    ctxt.shadowOffsetY = shadowOffsets[1]);\n  for(i = 0; i < strings.length; ++i) {\n    xc = 0;\n    if(widths) {\n      if('right' == align) {\n        xc = maxWidth - widths[i];\n      } else if('centre' == align) {\n        xc = (maxWidth - widths[i]) / 2;\n      }\n    }\n    ctxt.fillText(strings[i], xo + xc, yo);\n    yo += parseInt(font);\n  }\n}\nfunction RRect(c, x, y, w, h, r, s) {\n  if(r) {\n    c.beginPath();\n    c.moveTo(x, y + h - r);\n    c.arcTo(x, y, x + r, y, r);\n    c.arcTo(x + w, y, x + w, y + r, r);\n    c.arcTo(x + w, y + h, x + w - r, y + h, r);\n    c.arcTo(x, y + h, x, y + h - r, r);\n    c.closePath();\n    c[s ? 'stroke' : 'fill']();\n  } else {\n    c[s ? 'strokeRect' : 'fillRect'](x, y, w, h);\n  }\n}\nfunction TextCanvas(strings, font, w, h, maxWidth, stringWidths, align, valign,\n  scale) {\n  this.strings = strings;\n  this.font = font;\n  this.width = w;\n  this.height = h;\n  this.maxWidth = maxWidth;\n  this.stringWidths = stringWidths;\n  this.align = align;\n  this.valign = valign;\n  this.scale = scale;\n}\nTCVproto = TextCanvas.prototype;\nTCVproto.SetImage = function(image, w, h, position, padding, align, valign,\n  scale) {\n  this.image = image;\n  this.iwidth = w * this.scale;\n  this.iheight = h * this.scale;\n  this.ipos = position;\n  this.ipad = padding * this.scale;\n  this.iscale = scale;\n  this.ialign = align;\n  this.ivalign = valign;\n};\nTCVproto.Align = function(size, space, a) {\n  var pos = 0;\n  if(a == 'right' || a == 'bottom')\n    pos = space - size;\n  else if(a != 'left' && a != 'top')\n    pos = (space - size) / 2;\n  return pos;\n};\nTCVproto.Create = function(colour, bgColour, bgOutline, bgOutlineThickness,\n  shadowColour, shadowBlur, shadowOffsets, padding, radius) {\n  var cv, cw, ch, c, x1, x2, y1, y2, offx, offy, ix, iy, iw, ih, rr,\n    sox = abs(shadowOffsets[0]), soy = abs(shadowOffsets[1]), shadowcv, shadowc;\n  padding = max(padding, sox + shadowBlur, soy + shadowBlur);\n  x1 = 2 * (padding + bgOutlineThickness);\n  y1 = 2 * (padding + bgOutlineThickness);\n  cw = this.width + x1;\n  ch = this.height + y1;\n  offx = offy = padding + bgOutlineThickness;\n\n  if(this.image) {\n    ix = iy = padding + bgOutlineThickness;\n    iw = this.iwidth;\n    ih = this.iheight;\n    if(this.ipos == 'top' || this.ipos == 'bottom') {\n      if(iw < this.width)\n        ix += this.Align(iw, this.width, this.ialign);\n      else\n        offx += this.Align(this.width, iw, this.align);\n      if(this.ipos == 'top')\n        offy += ih + this.ipad;\n      else\n        iy += this.height + this.ipad;\n      cw = max(cw, iw + x1);\n      ch += ih + this.ipad;\n    } else {\n      if(ih < this.height)\n        iy += this.Align(ih, this.height, this.ivalign);\n      else\n        offy += this.Align(this.height, ih, this.valign);\n      if(this.ipos == 'right')\n        ix += this.width + this.ipad;\n      else\n        offx += iw + this.ipad;\n      cw += iw + this.ipad;\n      ch = max(ch, ih + y1);\n    }\n  }\n\n  cv = NewCanvas(cw, ch);\n  if(!cv)\n    return null;\n  x1 = y1 = bgOutlineThickness / 2;\n  x2 = cw - bgOutlineThickness;\n  y2 = ch - bgOutlineThickness;\n  rr = min(radius, x2 / 2, y2 / 2);\n  c = cv.getContext('2d');\n  if(bgColour) {\n    c.fillStyle = bgColour;\n    RRect(c, x1, y1, x2, y2, rr);\n  }\n  if(bgOutlineThickness) {\n    c.strokeStyle = bgOutline;\n    c.lineWidth = bgOutlineThickness;\n    RRect(c, x1, y1, x2, y2, rr, true);\n  }\n  if(shadowBlur || sox || soy) {\n    // use a transparent canvas to draw on\n    shadowcv = NewCanvas(cw, ch);\n    if(shadowcv) {\n      shadowc = c;\n      c = shadowcv.getContext('2d');\n    }\n  }\n\n  // don't use TextSet shadow support because it adds space for shadow\n  TextSet(c, this.font, colour, this.strings, offx, offy, 0, 0, [],\n    this.maxWidth, this.stringWidths, this.align);\n      \n  if(this.image)\n    c.drawImage(this.image, ix, iy, iw, ih);\n\n  if(shadowc) {\n    // draw the text and image with the added shadow\n    c = shadowc;\n    shadowColour && (c.shadowColor = shadowColour);\n    shadowBlur && (c.shadowBlur = shadowBlur);\n    c.shadowOffsetX = shadowOffsets[0];\n    c.shadowOffsetY = shadowOffsets[1];\n    c.drawImage(shadowcv, 0, 0);\n  }\n  return cv;\n};\nfunction ExpandImage(i, w, h) {\n  var cv = NewCanvas(w, h), c;\n  if(!cv)\n    return null;\n  c = cv.getContext('2d');\n  c.drawImage(i, (w - i.width) / 2, (h - i.height) / 2);\n  return cv;\n}\nfunction ScaleImage(i, w, h) {\n  var cv = NewCanvas(w, h), c;\n  if(!cv)\n    return null;\n  c = cv.getContext('2d');\n  c.drawImage(i, 0, 0, w, h);\n  return cv;\n}\nfunction AddBackgroundToImage(i, w, h, scale, colour, othickness, ocolour,\n  padding, radius, ofill) {\n  var cw = w + ((2 * padding) + othickness) * scale,\n    ch = h + ((2 * padding) + othickness) * scale,\n    cv = NewCanvas(cw, ch), c, x1, y1, x2, y2, ocanvas, cc, rr;\n  if(!cv)\n    return null;\n  othickness *= scale;\n  radius *= scale;\n  x1 = y1 = othickness / 2;\n  x2 = cw - othickness;\n  y2 = ch - othickness;\n  padding = (padding * scale) + x1; // add space for outline\n  c = cv.getContext('2d');\n  rr = min(radius, x2 / 2, y2 / 2);\n  if(colour) {\n    c.fillStyle = colour;\n    RRect(c, x1, y1, x2, y2, rr);\n  }\n  if(othickness) {\n    c.strokeStyle = ocolour;\n    c.lineWidth = othickness;\n    RRect(c, x1, y1, x2, y2, rr, true);\n  }\n  \n  if(ofill) {\n    // use compositing to colour in the image and border\n    ocanvas = NewCanvas(cw, ch);\n    cc = ocanvas.getContext('2d');\n    cc.drawImage(i, padding, padding, w, h);\n    cc.globalCompositeOperation = 'source-in';\n    cc.fillStyle = ocolour;\n    cc.fillRect(0, 0, cw, ch);\n    cc.globalCompositeOperation = 'destination-over';\n    cc.drawImage(cv, 0, 0);\n    cc.globalCompositeOperation = 'source-over';\n    c.drawImage(ocanvas, 0, 0);\n  } else {\n    c.drawImage(i, padding, padding, i.width, i.height);\n  }\n  return {image: cv, width: cw / scale, height: ch / scale};\n}\n/**\n * Rounds off the corners of an image\n */\nfunction RoundImage(i, r, iw, ih, s) {\n  var cv, c, r1 = parseFloat(r), l = max(iw, ih);\n  cv = NewCanvas(iw, ih);\n  if(!cv)\n    return null;\n  if(r.indexOf('%') > 0)\n    r1 = l * r1 / 100;\n  else\n    r1 = r1 * s;\n  c = cv.getContext('2d');\n  c.globalCompositeOperation = 'source-over';\n  c.fillStyle = '#fff';\n  if(r1 >= l/2) {\n    r1 = min(iw,ih) / 2;\n    c.beginPath();\n    c.moveTo(iw/2,ih/2);\n    c.arc(iw/2,ih/2,r1,0,2*Math.PI,false);\n    c.fill();\n    c.closePath();\n  } else {\n    r1 = min(iw/2,ih/2,r1);\n    RRect(c, 0, 0, iw, ih, r1, true);\n    c.fill();\n  }\n  c.globalCompositeOperation = 'source-in';\n  c.drawImage(i, 0, 0, iw, ih);\n  return cv;\n}\n/**\n * Creates a new canvas containing the image and its shadow\n * Returns an object containing the image and its dimensions at z=0\n */\nfunction AddShadowToImage(i, w, h, scale, sc, sb, so) {\n  var sw = abs(so[0]), sh = abs(so[1]), \n    cw = w + (sw > sb ? sw + sb : sb * 2) * scale,\n    ch = h + (sh > sb ? sh + sb : sb * 2) * scale,\n    xo = scale * ((sb || 0) + (so[0] < 0 ? sw : 0)),\n    yo = scale * ((sb || 0) + (so[1] < 0 ? sh : 0)), cv, c;\n  cv = NewCanvas(cw, ch);\n  if(!cv)\n    return null;\n  c = cv.getContext('2d');\n  sc && (c.shadowColor = sc);\n  sb && (c.shadowBlur = sb * scale);\n  so && (c.shadowOffsetX = so[0] * scale, c.shadowOffsetY = so[1] * scale);\n  c.drawImage(i, xo, yo, w, h);\n  return {image: cv, width: cw / scale, height: ch / scale};\n}\nfunction FindTextBoundingBox(s,f,ht) {\n  var w = parseInt(s.toString().length * ht), h = parseInt(ht * 2 * s.length),\n    cv = NewCanvas(w,h), c, idata, w1, h1, x, y, i, ex;\n  if(!cv)\n    return null;\n  c = cv.getContext('2d');\n  c.fillStyle = '#000';\n  c.fillRect(0,0,w,h);\n  TextSet(c,ht + 'px ' + f,'#fff',s,0,0,0,0,[],'centre')\n\n  idata = c.getImageData(0,0,w,h);\n  w1 = idata.width; h1 = idata.height;\n  ex = {\n    min: { x: w1, y: h1 },\n    max: { x: -1, y: -1 }\n  };\n  for(y = 0; y < h1; ++y) {\n    for(x = 0; x < w1; ++x) {\n      i = (y * w1 + x) * 4;\n      if(idata.data[i+1] > 0) {\n        if(x < ex.min.x) ex.min.x = x;\n        if(x > ex.max.x) ex.max.x = x;\n        if(y < ex.min.y) ex.min.y = y;\n        if(y > ex.max.y) ex.max.y = y;\n      }\n    }\n  }\n  // device pixels might not be css pixels\n  if(w1 != w) {\n    ex.min.x *= (w / w1);\n    ex.max.x *= (w / w1);\n  }\n  if(h1 != h) {\n    ex.min.y *= (w / h1);\n    ex.max.y *= (w / h1);\n  }\n\n  cv = null;\n  return ex;\n}\nfunction FixFont(f) {\n  return \"'\" + f.replace(/(\\'|\\\")/g,'').replace(/\\s*,\\s*/g, \"', '\") + \"'\";\n}\nfunction AddHandler(h,f,e) {\n  e = e || doc;\n  if(e.addEventListener)\n    e.addEventListener(h,f,false);\n  else\n    e.attachEvent('on' + h, f);\n}\nfunction RemoveHandler(h,f,e) {\n  e = e || doc;\n  if(e.removeEventListener)\n    e.removeEventListener(h, f);\n  else\n    e.detachEvent('on' + h, f);\n}\nfunction AddImage(i, o, t, tc) {\n  var s = tc.imageScale, mscale, ic, bc, oc, iw, ih;\n  // image not loaded, wait for image onload\n  if(!o.complete)\n    return AddHandler('load',function() { AddImage(i,o,t,tc); }, o);\n  if(!i.complete)\n    return AddHandler('load',function() { AddImage(i,o,t,tc); }, i);\n\n  // Yes, this does look like nonsense, but it makes sure that both the\n  // width and height are actually set and not just calculated. This is\n  // required to keep proportional sizes when the images are hidden, so\n  // the images can be used again for another cloud.\n  o.width = o.width;\n  o.height = o.height;\n\n  if(s) {\n    i.width = o.width * s;\n    i.height = o.height * s;\n  }\n  // the standard width of the image, with imageScale applied\n  t.iw = i.width;\n  t.ih = i.height;\n  if(tc.txtOpt) {\n    ic = i;\n    mscale = tc.zoomMax * tc.txtScale;\n    iw = t.iw * mscale;\n    ih = t.ih * mscale;\n    if(iw < o.naturalWidth || ih < o.naturalHeight) {\n      ic = ScaleImage(i, iw, ih);\n      if(ic)\n        t.fimage = ic;\n    } else {\n      iw = t.iw;\n      ih = t.ih;\n      mscale = 1;\n    }\n    if(parseFloat(tc.imageRadius))\n      t.image = t.fimage = i = RoundImage(t.image, tc.imageRadius, iw, ih, mscale);\n    if(!t.HasText()) {\n      if(tc.shadow) {\n        ic = AddShadowToImage(t.image, iw, ih, mscale, tc.shadow, tc.shadowBlur,\n          tc.shadowOffset);\n        if(ic) {\n          t.fimage = ic.image;\n          t.w = ic.width;\n          t.h = ic.height;\n        }\n      }\n      if(tc.bgColour || tc.bgOutlineThickness) {\n        bc = tc.bgColour == 'tag' ? GetProperty(t.a, 'background-color') :\n          tc.bgColour;\n        oc = tc.bgOutline == 'tag' ? GetProperty(t.a, 'color') : \n          (tc.bgOutline || tc.textColour);\n        iw = t.fimage.width;\n        ih = t.fimage.height;\n        if(tc.outlineMethod == 'colour') {\n          // create the outline version first, using the current image state\n          ic = AddBackgroundToImage(t.fimage, iw, ih, mscale, bc,\n            tc.bgOutlineThickness, t.outline.colour, tc.padding, tc.bgRadius, 1);\n          if(ic)\n            t.oimage = ic.image;\n        }\n        ic = AddBackgroundToImage(t.fimage, iw, ih, mscale, bc, \n          tc.bgOutlineThickness, oc, tc.padding, tc.bgRadius);\n        if(ic) {\n          t.fimage = ic.image;\n          t.w = ic.width;\n          t.h = ic.height;\n        }\n      }\n      if(tc.outlineMethod == 'size') {\n        if(tc.outlineIncrease > 0) {\n          t.iw += 2 * tc.outlineIncrease;\n          t.ih += 2 * tc.outlineIncrease;\n          iw = mscale * t.iw;\n          ih = mscale * t.ih;\n          ic = ScaleImage(t.fimage, iw, ih);\n          t.oimage = ic;\n          t.fimage = ExpandImage(t.fimage, t.oimage.width, t.oimage.height);\n        } else {\n          iw = mscale * (t.iw + (2 * tc.outlineIncrease));\n          ih = mscale * (t.ih + (2 * tc.outlineIncrease));\n          ic = ScaleImage(t.fimage, iw, ih);\n          t.oimage = ExpandImage(ic, t.fimage.width, t.fimage.height);\n        }\n      }\n    }\n  }\n  t.Init();\n}\nfunction GetProperty(e,p) {\n  var dv = doc.defaultView, pc = p.replace(/\\-([a-z])/g,function(a){return a.charAt(1).toUpperCase()});\n  return (dv && dv.getComputedStyle && dv.getComputedStyle(e,null).getPropertyValue(p)) ||\n    (e.currentStyle && e.currentStyle[pc]);\n}\nfunction FindWeight(a, wFrom, tHeight) {\n  var w = 1, p;\n  if(wFrom) {\n    w = 1 * (a.getAttribute(wFrom) || tHeight);\n  } else if(p = GetProperty(a,'font-size')) {\n    w = (p.indexOf('px') > -1 && p.replace('px','') * 1) ||\n      (p.indexOf('pt') > -1 && p.replace('pt','') * 1.25) ||\n      p * 3.3;\n  }\n  return w;\n}\nfunction EventToCanvasId(e) {\n  return e.target && Defined(e.target.id) ? e.target.id :\n    e.srcElement.parentNode.id;\n}\nfunction EventXY(e, c) {\n  var xy, p, xmul = parseInt(GetProperty(c, 'width')) / c.width,\n    ymul = parseInt(GetProperty(c, 'height')) / c.height;\n  if(Defined(e.offsetX)) {\n    xy = {x: e.offsetX, y: e.offsetY};\n  } else {\n    p = AbsPos(c.id);\n    if(Defined(e.changedTouches))\n      e = e.changedTouches[0];\n    if(e.pageX)\n      xy = {x: e.pageX - p.x, y: e.pageY - p.y};\n  }\n  if(xy && xmul && ymul) {\n    xy.x /= xmul;\n    xy.y /= ymul;\n  }\n  return xy;\n}\nfunction MouseOut(e) {\n  var cv = e.target || e.fromElement.parentNode, tc = TagCanvas.tc[cv.id];\n  if(tc) {\n   tc.mx = tc.my = -1;\n   tc.UnFreeze();\n   tc.EndDrag();\n  }\n}\nfunction MouseMove(e) {\n  var i, t = TagCanvas, tc, p, tg = EventToCanvasId(e);\n  for(i in t.tc) {\n    tc = t.tc[i];\n    if(tc.tttimer) {\n      clearTimeout(tc.tttimer);\n      tc.tttimer = null;\n    }\n  }\n  if(tg && t.tc[tg]) {\n    tc = t.tc[tg];\n    if(p = EventXY(e, tc.canvas)) {\n      tc.mx = p.x;\n      tc.my = p.y;\n      tc.Drag(e, p);\n    }\n    tc.drawn = 0;\n  }\n}\nfunction MouseDown(e) {\n  var t = TagCanvas, cb = doc.addEventListener ? 0 : 1,\n    tg = EventToCanvasId(e);\n  if(tg && e.button == cb && t.tc[tg]) {\n    t.tc[tg].BeginDrag(e);\n  }\n}\nfunction MouseUp(e) {\n  var t = TagCanvas, cb = doc.addEventListener ? 0 : 1,\n    tg = EventToCanvasId(e), tc;\n  if(tg && e.button == cb && t.tc[tg]) {\n    tc = t.tc[tg];\n    MouseMove(e);\n    if(!tc.EndDrag() && !tc.touchState)\n      tc.Clicked(e);\n  }\n}\nfunction TouchDown(e) {\n  var tg = EventToCanvasId(e), tc = (tg && TagCanvas.tc[tg]), p;\n  if(tc && e.changedTouches) {\n    if(e.touches.length == 1 && tc.touchState == 0) {\n      tc.touchState = 1;\n      tc.BeginDrag(e);\n      if(p = EventXY(e, tc.canvas)) {\n        tc.mx = p.x;\n        tc.my = p.y;\n        tc.drawn = 0;\n      }\n    } else if(e.targetTouches.length == 2 && tc.pinchZoom) {\n      tc.touchState = 3;\n      tc.EndDrag();\n      tc.BeginPinch(e);\n    } else {\n      tc.EndDrag();\n      tc.EndPinch();\n      tc.touchState = 0;\n    }\n  }\n}\nfunction TouchUp(e) {\n  var tg = EventToCanvasId(e), tc = (tg && TagCanvas.tc[tg]);\n  if(tc && e.changedTouches) {\n    switch(tc.touchState) {\n    case 1:\n      tc.Draw();\n      tc.Clicked();\n      break;\n    case 2:\n      tc.EndDrag();\n      break;\n    case 3:\n      tc.EndPinch();\n    }\n    tc.touchState = 0;\n  }\n}\nfunction TouchMove(e) {\n  var i, t = TagCanvas, tc, p, tg = EventToCanvasId(e);\n  for(i in t.tc) {\n    tc = t.tc[i];\n    if(tc.tttimer) {\n      clearTimeout(tc.tttimer);\n      tc.tttimer = null;\n    }\n  }\n  tc = (tg && t.tc[tg]);\n  if(tc && e.changedTouches && tc.touchState) {\n    switch(tc.touchState) {\n    case 1:\n    case 2:\n      if(p = EventXY(e, tc.canvas)) {\n        tc.mx = p.x;\n        tc.my = p.y;\n        if(tc.Drag(e, p))\n          tc.touchState = 2;\n      }\n      break;\n    case 3:\n      tc.Pinch(e);\n    }\n    tc.drawn = 0;\n  }\n}\nfunction MouseWheel(e) {\n  var t = TagCanvas, tg = EventToCanvasId(e);\n  if(tg && t.tc[tg]) {\n    e.cancelBubble = true;\n    e.returnValue = false;\n    e.preventDefault && e.preventDefault();\n    t.tc[tg].Wheel((e.wheelDelta || e.detail) > 0);\n  }\n}\nfunction Scroll(e) {\n  var i, t = TagCanvas;\n  clearTimeout(t.scrollTimer);\n  for(i in t.tc) {\n    t.tc[i].Pause();\n  }\n  t.scrollTimer = setTimeout(function() {\n    var i, t = TagCanvas;\n    for(i in t.tc) {\n      t.tc[i].Resume();\n    }\n  }, t.scrollPause);\n}\nfunction DrawCanvas() {\n  DrawCanvasRAF(TimeNow());\n}\nfunction DrawCanvasRAF(t) {\n  var tc = TagCanvas.tc, i;\n  TagCanvas.NextFrame(TagCanvas.interval);\n  t = t || TimeNow();\n  for(i in tc)\n    tc[i].Draw(t);\n}\nfunction AbsPos(id) {\n  var e = doc.getElementById(id), r = e.getBoundingClientRect(),\n    dd = doc.documentElement, b = doc.body, w = window,\n    xs = w.pageXOffset || dd.scrollLeft,\n    ys = w.pageYOffset || dd.scrollTop,\n    xo = dd.clientLeft || b.clientLeft,\n    yo = dd.clientTop || b.clientTop;\n  return { x: r.left + xs - xo, y: r.top + ys - yo };\n}\nfunction Project(tc,p1,sx,sy) {\n  var m = tc.radius * tc.z1 / (tc.z1 + tc.z2 + p1.z);\n  return {\n    x: p1.x * m * sx,\n    y: p1.y * m * sy,\n    z: p1.z,\n    w: (tc.z1 - p1.z) / tc.z2\n  };\n}\n/**\n * @constructor\n * for recursively splitting tag contents on <br> tags\n */\nfunction TextSplitter(e) {\n  this.e = e;\n  this.br = 0;\n  this.line = [];\n  this.text = [];\n  this.original = e.innerText || e.textContent;\n}\nTSproto = TextSplitter.prototype;\nTSproto.Empty = function() {\n  for(var i = 0; i < this.text.length; ++i)\n    if(this.text[i].length)\n      return false;\n  return true;\n};\nTSproto.Lines = function(e) {\n  var r = e ? 1 : 0, cn, cl, i;\n  e = e || this.e;\n  cn = e.childNodes;\n  cl = cn.length;\n\n  for(i = 0; i < cl; ++i) {\n    if(cn[i].nodeName == 'BR') {\n      this.text.push(this.line.join(' '));\n      this.br = 1;\n    } else if(cn[i].nodeType == 3) {\n      if(this.br) {\n        this.line = [cn[i].nodeValue];\n        this.br = 0;\n      } else {\n        this.line.push(cn[i].nodeValue);\n      }\n    } else {\n      this.Lines(cn[i]);\n    }\n  }\n  r || this.br || this.text.push(this.line.join(' '));\n  return this.text;\n};\nTSproto.SplitWidth = function(w, c, f, h) {\n  var i, j, words, text = [];\n  c.font = h + 'px ' + f;\n  for(i = 0; i < this.text.length; ++i) {\n    words = this.text[i].split(/\\s+/);\n    this.line = [words[0]];\n    for(j = 1; j < words.length; ++j) {\n      if(c.measureText(this.line.join(' ') + ' ' + words[j]).width > w) {\n        text.push(this.line.join(' '));\n        this.line = [words[j]];\n      } else {\n        this.line.push(words[j]);\n      }\n    }\n    text.push(this.line.join(' '));\n  }\n  return this.text = text;\n};\n/**\n * @constructor\n */\nfunction Outline(tc,t) {\n  this.ts = null;\n  this.tc = tc;\n  this.tag = t;\n  this.x = this.y = this.w = this.h = this.sc = 1;\n  this.z = 0;\n  this.pulse = 1;\n  this.pulsate = tc.pulsateTo < 1;\n  this.colour = tc.outlineColour;\n  this.adash = ~~tc.outlineDash;\n  this.agap = ~~tc.outlineDashSpace || this.adash;\n  this.aspeed = tc.outlineDashSpeed * 1;\n  if(this.colour == 'tag')\n    this.colour = GetProperty(t.a, 'color');\n  else if(this.colour == 'tagbg')\n    this.colour = GetProperty(t.a, 'background-color');\n  this.Draw = this.pulsate ? this.DrawPulsate : this.DrawSimple;\n  this.radius = tc.outlineRadius | 0;\n  this.SetMethod(tc.outlineMethod);\n}\nOproto = Outline.prototype;\nOproto.SetMethod = function(om) {\n  var methods = {\n    block: ['PreDraw','DrawBlock'],\n    colour: ['PreDraw','DrawColour'],\n    outline: ['PostDraw','DrawOutline'],\n    classic: ['LastDraw','DrawOutline'],\n    size: ['PreDraw','DrawSize'],\n    none: ['LastDraw']\n  }, funcs = methods[om] || methods.outline;\n  if(om == 'none') {\n    this.Draw = function() { return 1; }\n  } else {\n    this.drawFunc = this[funcs[1]];\n  }\n  this[funcs[0]] = this.Draw;\n};\nOproto.Update = function(x,y,w,h,sc,z,xo,yo) {\n  var o = this.tc.outlineOffset, o2 = 2 * o;\n  this.x = sc * x + xo - o;\n  this.y = sc * y + yo - o;\n  this.w = sc * w + o2;\n  this.h = sc * h + o2;\n  this.sc = sc; // used to determine frontmost\n  this.z = z;\n};\nOproto.Ants = function(c) {\n  if(!this.adash)\n    return;\n  var l = this.adash, g = this.agap, s = this.aspeed, length = l + g,\n    l1 = 0, l2 = l, g1 = g, g2 = 0, seq = 0, ants;\n  if(s) {\n    seq = abs(s) * (TimeNow() - this.ts) / 50;\n    if(s < 0)\n      seq = 8.64e6 - seq;\n    s = ~~seq % length;\n  }\n  if(s) {\n    if(l >= s) {\n      l1 = l - s;\n      l2 = s;\n    } else {\n      g1 = length - s;\n      g2 = g - g1;\n    }\n    ants = [l1, g1, l2, g2];\n  } else {\n    ants = [l,g];\n  }\n  c.setLineDash(ants);\n}\nOproto.DrawOutline = function(c,x,y,w,h,colour) {\n  var r = min(this.radius, h/2, w/2);\n  c.strokeStyle = colour;\n  this.Ants(c);\n  RRect(c, x, y, w, h, r, true);\n};\nOproto.DrawSize = function(c,x,y,w,h,colour,tag,x1,y1) {\n  var tw = tag.w, th = tag.h, m, i, sc;\n  if(this.pulsate) {\n    if(tag.image)\n      sc = (tag.image.height + this.tc.outlineIncrease) / tag.image.height;\n    else\n      sc = tag.oscale;\n    i = tag.fimage || tag.image;\n    m = 1 + ((sc - 1) * (1-this.pulse));\n    tag.h *= m;\n    tag.w *= m;\n  } else {\n    i = tag.oimage;\n  }\n  tag.alpha = 1;\n  tag.Draw(c, x1, y1, i);\n  tag.h = th;\n  tag.w = tw;\n  return 1;\n};\nOproto.DrawColour = function(c,x,y,w,h,colour,tag,x1,y1) {\n  if(tag.oimage) {\n    if(this.pulse < 1) {\n      tag.alpha = 1 - pow(this.pulse, 2);\n      tag.Draw(c, x1, y1, tag.fimage);\n      tag.alpha = this.pulse;\n    } else {\n      tag.alpha = 1;\n    }\n    tag.Draw(c, x1, y1, tag.oimage);\n    return 1;\n  }\n  return this[tag.image ? 'DrawColourImage' : 'DrawColourText'](c,x,y,w,h,colour,tag,x1,y1);\n};\nOproto.DrawColourText = function(c,x,y,w,h,colour,tag,x1,y1) {\n  var normal = tag.colour;\n  tag.colour = colour;\n  tag.alpha = 1;\n  tag.Draw(c,x1,y1);\n  tag.colour = normal;\n  return 1;\n};\nOproto.DrawColourImage = function(c,x,y,w,h,colour,tag,x1,y1) {\n  var ccanvas = c.canvas, fx = ~~max(x,0), fy = ~~max(y,0), \n    fw = min(ccanvas.width - fx, w) + .5|0, fh = min(ccanvas.height - fy,h) + .5|0, cc;\n  if(ocanvas)\n    ocanvas.width = fw, ocanvas.height = fh;\n  else\n    ocanvas = NewCanvas(fw, fh);\n  if(!ocanvas)\n    return this.SetMethod('outline'); // if using IE and images, give up!\n  cc = ocanvas.getContext('2d');\n\n  cc.drawImage(ccanvas,fx,fy,fw,fh,0,0,fw,fh);\n  c.clearRect(fx,fy,fw,fh);\n  if(this.pulsate) {\n    tag.alpha = 1 - pow(this.pulse, 2);\n  } else {\n    tag.alpha = 1;\n  }\n  tag.Draw(c,x1,y1);\n  c.setTransform(1,0,0,1,0,0);\n  c.save();\n  c.beginPath();\n  c.rect(fx,fy,fw,fh);\n  c.clip();\n  c.globalCompositeOperation = 'source-in';\n  c.fillStyle = colour;\n  c.fillRect(fx,fy,fw,fh);\n  c.restore();\n  c.globalAlpha = 1;\n  c.globalCompositeOperation = 'destination-over';\n  c.drawImage(ocanvas,0,0,fw,fh,fx,fy,fw,fh);\n  c.globalCompositeOperation = 'source-over';\n  return 1;\n};\nOproto.DrawBlock = function(c,x,y,w,h,colour) {\n  var r = min(this.radius, h/2, w/2);\n  c.fillStyle = colour;\n  RRect(c, x, y, w, h, r);\n};\nOproto.DrawSimple = function(c, tag, x1, y1, ga, useGa) {\n  var t = this.tc;\n  c.setTransform(1,0,0,1,0,0);\n  c.strokeStyle = this.colour;\n  c.lineWidth = t.outlineThickness;\n  c.shadowBlur = c.shadowOffsetX = c.shadowOffsetY = 0;\n  c.globalAlpha = useGa ? ga : 1;\n  return this.drawFunc(c,this.x,this.y,this.w,this.h,this.colour,tag,x1,y1);\n};\nOproto.DrawPulsate = function(c, tag, x1, y1) {\n  var diff = TimeNow() - this.ts, t = this.tc,\n    ga = t.pulsateTo + ((1 - t.pulsateTo) * \n    (0.5 + (cos(2 * Math.PI * diff / (1000 * t.pulsateTime)) / 2)));\n  this.pulse = ga = TagCanvas.Smooth(1,ga);\n  return this.DrawSimple(c, tag, x1, y1, ga, 1);\n};\nOproto.Active = function(c,x,y) {\n  var a = (x >= this.x && y >= this.y &&\n    x <= this.x + this.w && y <= this.y + this.h);\n  if(a) {\n    this.ts = this.ts || TimeNow();\n  } else {\n    this.ts = null;\n  }\n  return a;\n};\nOproto.PreDraw = Oproto.PostDraw = Oproto.LastDraw = Nop;\n/**\n * @constructor\n */\nfunction Tag(tc, text, a, v, w, h, col, bcol, bradius, boutline, bothickness,\n  font, padding, original) {\n  this.tc = tc;\n  this.image = null;\n  this.text = text;\n  this.text_original = original;\n  this.line_widths = [];\n  this.title = a.title || null;\n  this.a = a;\n  this.position = new Vector(v[0], v[1], v[2]);\n  this.x = this.y = this.z = 0;\n  this.w = w;\n  this.h = h;\n  this.colour = col || tc.textColour;\n  this.bgColour = bcol || tc.bgColour;\n  this.bgRadius = bradius | 0;\n  this.bgOutline = boutline || this.colour;\n  this.bgOutlineThickness = bothickness | 0;\n  this.textFont = font || tc.textFont;\n  this.padding = padding | 0;\n  this.sc = this.alpha = 1;\n  this.weighted = !tc.weight;\n  this.outline = new Outline(tc,this);\n}\nTproto = Tag.prototype;\nTproto.Init = function(e) {\n  var tc = this.tc;\n  this.textHeight = tc.textHeight;\n  if(this.HasText()) {\n    this.Measure(tc.ctxt,tc);\n  } else {\n    this.w = this.iw;\n    this.h = this.ih;\n  }\n\n  this.SetShadowColour = tc.shadowAlpha ? this.SetShadowColourAlpha : this.SetShadowColourFixed;\n  this.SetDraw(tc);\n};\nTproto.Draw = Nop;\nTproto.HasText = function() {\n  return this.text && this.text[0].length > 0;\n};\nTproto.EqualTo = function(e) {\n  var i = e.getElementsByTagName('img');\n  if(this.a.href != e.href)\n    return 0;\n  if(i.length)\n    return this.image.src == i[0].src;\n  return (e.innerText || e.textContent) == this.text_original;\n};\nTproto.SetImage = function(i) {\n  this.image = this.fimage = i;\n};\nTproto.SetDraw = function(t) {\n  this.Draw = this.fimage ? (t.ie > 7 ? this.DrawImageIE : this.DrawImage) : this.DrawText;\n  t.noSelect && (this.CheckActive = Nop);\n};\nTproto.MeasureText = function(c) {\n  var i, l = this.text.length, w = 0, wl;\n  for(i = 0; i < l; ++i) {\n    this.line_widths[i] = wl = c.measureText(this.text[i]).width;\n    w = max(w, wl);\n  }\n  return w;\n};\nTproto.Measure = function(c,t) {\n  var extents = FindTextBoundingBox(this.text, this.textFont, this.textHeight),\n    s, th, f, soff, cw, twidth, theight, img, tcv;\n  // add the gap at the top to the height to make equal gap at bottom\n  theight = extents ? extents.max.y + extents.min.y : this.textHeight;\n  c.font = this.font = this.textHeight + 'px ' + this.textFont;\n  twidth = this.MeasureText(c);\n  if(t.txtOpt) {\n    s = t.txtScale;\n    th = s * this.textHeight;\n    f = th + 'px ' + this.textFont;\n    soff = [s * t.shadowOffset[0], s * t.shadowOffset[1]];\n    c.font = f;\n    cw = this.MeasureText(c);\n    tcv = new TextCanvas(this.text, f, cw + s, (s * theight) + s, cw,\n      this.line_widths, t.textAlign, t.textVAlign, s);\n\n    if(this.image)\n      tcv.SetImage(this.image, this.iw, this.ih, t.imagePosition, t.imagePadding,\n        t.imageAlign, t.imageVAlign, t.imageScale);\n\n    img = tcv.Create(this.colour, this.bgColour, this.bgOutline,\n      s * this.bgOutlineThickness, t.shadow, s * t.shadowBlur, soff,\n      s * this.padding, s * this.bgRadius);\n\n    // add outline image using highlight colour\n    if(t.outlineMethod == 'colour') {\n      this.oimage = tcv.Create(this.outline.colour, this.bgColour, this.outline.colour,\n        s * this.bgOutlineThickness, t.shadow, s * t.shadowBlur, soff,\n        s * this.padding, s * this.bgRadius);\n\n    } else if(t.outlineMethod == 'size') {\n      extents = FindTextBoundingBox(this.text, this.textFont,\n        this.textHeight + t.outlineIncrease);\n      th = extents.max.y + extents.min.y;\n      f = (s * (this.textHeight + t.outlineIncrease)) + 'px ' + this.textFont;\n      c.font = f;\n      cw = this.MeasureText(c);\n\n      tcv = new TextCanvas(this.text, f, cw + s, (s * th) + s, cw,\n        this.line_widths, t.textAlign, t.textVAlign, s);\n      if(this.image)\n        tcv.SetImage(this.image, this.iw + t.outlineIncrease,\n          this.ih + t.outlineIncrease, t.imagePosition, t.imagePadding,\n          t.imageAlign, t.imageVAlign, t.imageScale);\n          \n      this.oimage = tcv.Create(this.colour, this.bgColour, this.bgOutline,\n        s * this.bgOutlineThickness, t.shadow, s * t.shadowBlur, soff,\n        s * this.padding, s * this.bgRadius);\n\n      this.oscale = this.oimage.width / img.width;\n      if(t.outlineIncrease > 0)\n        img = ExpandImage(img, this.oimage.width, this.oimage.height);\n      else\n        this.oimage = ExpandImage(this.oimage, img.width, img.height);\n    }\n    if(img) {\n      this.fimage = img;\n      twidth = this.fimage.width / s;\n      theight = this.fimage.height / s;\n    }\n    this.SetDraw(t);\n    t.txtOpt = !!this.fimage;\n  }\n  this.h = theight;\n  this.w = twidth;\n};\nTproto.SetFont = function(f, c, bc, boc) {\n  this.textFont = f;\n  this.colour = c;\n  this.bgColour = bc;\n  this.bgOutline = boc;\n  this.Measure(this.tc.ctxt, this.tc);\n};\nTproto.SetWeight = function(w) {\n  var tc = this.tc, modes = tc.weightMode.split(/[, ]/), m, s, wl = w.length;\n  if(!this.HasText())\n    return;\n  this.weighted = true;\n  for(s = 0; s < wl; ++s) {\n    m = modes[s] || 'size';\n    if('both' == m) {\n      this.Weight(w[s], tc.ctxt, tc, 'size', tc.min_weight[s], \n        tc.max_weight[s], s);\n      this.Weight(w[s], tc.ctxt, tc, 'colour', tc.min_weight[s],\n        tc.max_weight[s], s);\n    } else {\n      this.Weight(w[s], tc.ctxt, tc, m, tc.min_weight[s], tc.max_weight[s], s);\n    }\n  }\n  this.Measure(tc.ctxt, tc);\n};\nTproto.Weight = function(w, c, t, m, wmin, wmax, wnum) {\n  w = isNaN(w) ? 1 : w;\n  var nweight = (w - wmin) / (wmax - wmin);\n  if('colour' == m)\n    this.colour = FindGradientColour(t, nweight, wnum);\n  else if('bgcolour' == m)\n    this.bgColour = FindGradientColour(t, nweight, wnum);\n  else if('bgoutline' == m)\n    this.bgOutline = FindGradientColour(t, nweight, wnum);\n  else if('outline' == m)\n    this.outline.colour = FindGradientColour(t, nweight, wnum);\n  else if('size' == m) {\n    if(t.weightSizeMin > 0 && t.weightSizeMax > t.weightSizeMin) {\n      this.textHeight = t.weightSize * \n        (t.weightSizeMin + (t.weightSizeMax - t.weightSizeMin) * nweight);\n    } else {\n      // min textHeight of 1\n      this.textHeight = max(1, w * t.weightSize);\n    }\n  }\n};\nTproto.SetShadowColourFixed = function(c,s,a) {\n  c.shadowColor = s;\n};\nTproto.SetShadowColourAlpha = function(c,s,a) {\n  c.shadowColor = SetAlpha(s, a);\n};\nTproto.DrawText = function(c,xoff,yoff) {\n  var t = this.tc, x = this.x, y = this.y, s = this.sc, i, xl;\n  c.globalAlpha = this.alpha;\n  c.fillStyle = this.colour;\n  t.shadow && this.SetShadowColour(c,t.shadow,this.alpha);\n  c.font = this.font;\n  x += xoff / s;\n  y += (yoff / s) - (this.h / 2);\n  for(i = 0; i < this.text.length; ++i) {\n    xl = x;\n    if('right' == t.textAlign) {\n      xl += this.w / 2 - this.line_widths[i];\n    } else if('centre' == t.textAlign) {\n      xl -= this.line_widths[i] / 2;\n    } else {\n      xl -= this.w / 2;\n    }\n    c.setTransform(s, 0, 0, s, s * xl, s * y);\n    c.fillText(this.text[i], 0, 0);\n    y += this.textHeight;\n  }\n};\nTproto.DrawImage = function(c,xoff,yoff,im) {\n  var x = this.x, y = this.y, s = this.sc,\n    i = im || this.fimage, w = this.w, h = this.h, a = this.alpha,\n    shadow = this.shadow;\n  c.globalAlpha = a;\n  shadow && this.SetShadowColour(c,shadow,a);\n  x += (xoff / s) - (w / 2);\n  y += (yoff / s) - (h / 2);\n  c.setTransform(s, 0, 0, s, s * x, s * y);\n  c.drawImage(i, 0, 0, w, h);\n};\nTproto.DrawImageIE = function(c,xoff,yoff) {\n  var i = this.fimage, s = this.sc,\n    w = i.width = this.w*s, h = i.height = this.h * s,\n    x = (this.x*s) + xoff - (w/2), y = (this.y*s) + yoff - (h/2);\n  c.setTransform(1,0,0,1,0,0);\n  c.globalAlpha = this.alpha;\n  c.drawImage(i, x, y);\n};\nTproto.Calc = function(m,a) {\n  var pp, t = this.tc, mnb = t.minBrightness,\n    mxb = t.maxBrightness, r = t.max_radius;\n  pp = m.xform(this.position);\n  this.xformed = pp;\n  pp = Project(t, pp, t.stretchX, t.stretchY);\n  this.x = pp.x;\n  this.y = pp.y;\n  this.z = pp.z;\n  this.sc = pp.w;\n  this.alpha = a * Clamp(mnb + (mxb - mnb) * (r - this.z) / (2 * r), 0, 1);\n  return this.xformed;\n};\nTproto.UpdateActive = function(c, xoff, yoff) {\n  var o = this.outline, w = this.w, h = this.h,\n    x = this.x - w/2, y = this.y - h/2;\n  o.Update(x, y, w, h, this.sc, this.z, xoff, yoff);\n  return o;\n};\nTproto.CheckActive = function(c,xoff,yoff) {\n  var t = this.tc, o = this.UpdateActive(c, xoff, yoff);\n  return o.Active(c, t.mx, t.my) ? o : null;\n};\nTproto.Clicked = function(e) {\n  var a = this.a, t = a.target, h = a.href, evt;\n  if(t != '' && t != '_self') {\n    if(self.frames[t]) {\n      self.frames[t].document.location = h;\n    } else{\n      try {\n        if(top.frames[t]) {\n          top.frames[t].document.location = h;\n          return;\n        }\n      } catch(err) {\n        // different domain/port/protocol?\n      }\n      window.open(h, t);\n    }\n    return;\n  }\n  if(doc.createEvent) {\n    evt = doc.createEvent('MouseEvents');\n    evt.initMouseEvent('click', 1, 1, window, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, null);\n    if(!a.dispatchEvent(evt))\n      return;\n  } else if(a.fireEvent) {\n    if(!a.fireEvent('onclick'))\n      return;\n  }\n  doc.location = h;\n};\n/**\n * @constructor\n */\nfunction TagCanvas(cid,lctr,opt) {\n  var i, p, c = doc.getElementById(cid), cp = ['id','class','innerHTML'], raf;\n\n  if(!c) throw 0;\n  if(Defined(window.G_vmlCanvasManager)) {\n    c = window.G_vmlCanvasManager.initElement(c);\n    this.ie = parseFloat(navigator.appVersion.split('MSIE')[1]);\n  }\n  if(c && (!c.getContext || !c.getContext('2d').fillText)) {\n    p = doc.createElement('DIV');\n    for(i = 0; i < cp.length; ++i)\n      p[cp[i]] = c[cp[i]];\n    c.parentNode.insertBefore(p,c);\n    c.parentNode.removeChild(c);\n    throw 0;\n  }\n  for(i in TagCanvas.options)\n    this[i] = opt && Defined(opt[i]) ? opt[i] : \n      (Defined(TagCanvas[i]) ? TagCanvas[i] : TagCanvas.options[i]);\n\n  this.canvas = c;\n  this.ctxt = c.getContext('2d');\n  this.z1 = 250 / max(this.depth, 0.001);\n  this.z2 = this.z1 / this.zoom;\n  this.radius = min(c.height, c.width) * 0.0075; // fits radius of 100 in canvas\n  this.max_radius = 100;\n  this.max_weight = [];\n  this.min_weight = [];\n  this.textFont = this.textFont && FixFont(this.textFont);\n  this.textHeight *= 1;\n  this.imageRadius = this.imageRadius.toString();\n  this.pulsateTo = Clamp(this.pulsateTo, 0, 1);\n  this.minBrightness = Clamp(this.minBrightness, 0, 1);\n  this.maxBrightness = Clamp(this.maxBrightness, this.minBrightness, 1);\n  this.ctxt.textBaseline = 'top';\n  this.lx = (this.lock + '').indexOf('x') + 1;\n  this.ly = (this.lock + '').indexOf('y') + 1;\n  this.frozen = this.dx = this.dy = this.fixedAnim = this.touchState = 0;\n  this.fixedAlpha = 1;\n  this.source = lctr || cid;\n  this.repeatTags = min(64, ~~this.repeatTags);\n  this.minTags = min(200, ~~this.minTags);\n  if(~~this.scrollPause > 0)\n    TagCanvas.scrollPause = ~~this.scrollPause;\n  else\n    this.scrollPause = 0;\n  if(this.minTags > 0 && this.repeatTags < 1 && (i = this.GetTags().length))\n    this.repeatTags = ceil(this.minTags / i) - 1;\n  this.transform = Matrix.Identity();\n  this.startTime = this.time = TimeNow();\n  this.mx = this.my = -1;\n  this.centreImage && CentreImage(this);\n  this.Animate = this.dragControl ? this.AnimateDrag : this.AnimatePosition;\n  this.animTiming = (typeof TagCanvas[this.animTiming] == 'function' ?\n    TagCanvas[this.animTiming] : TagCanvas.Smooth);\n  if(this.shadowBlur || this.shadowOffset[0] || this.shadowOffset[1]) {\n    // let the browser translate \"red\" into \"#ff0000\"\n    this.ctxt.shadowColor = this.shadow;\n    this.shadow = this.ctxt.shadowColor;\n    this.shadowAlpha = ShadowAlphaBroken();\n  } else {\n    delete this.shadow;\n  }\n  this.Load();\n  if(lctr && this.hideTags) {\n    (function(t) {\n    if(TagCanvas.loaded)\n      t.HideTags();\n    else\n      AddHandler('load', function() { t.HideTags(); }, window);\n    })(this);\n  }\n\n  this.yaw = this.initial ? this.initial[0] * this.maxSpeed : 0;\n  this.pitch = this.initial ? this.initial[1] * this.maxSpeed : 0;\n  if(this.tooltip) {\n    this.ctitle = c.title;\n    c.title = '';\n    if(this.tooltip == 'native') {\n      this.Tooltip = this.TooltipNative;\n    } else {\n      this.Tooltip = this.TooltipDiv;\n      if(!this.ttdiv) {\n        this.ttdiv = doc.createElement('div');\n        this.ttdiv.className = this.tooltipClass;\n        this.ttdiv.style.position = 'absolute';\n        this.ttdiv.style.zIndex = c.style.zIndex + 1;\n        AddHandler('mouseover',function(e){e.target.style.display='none';},this.ttdiv);\n        doc.body.appendChild(this.ttdiv);\n      }\n    }\n  } else {\n    this.Tooltip = this.TooltipNone;\n  }\n  if(!this.noMouse && !handlers[cid]) {\n    handlers[cid] = [\n      ['mousemove', MouseMove],\n      ['mouseout', MouseOut],\n      ['mouseup', MouseUp],\n      ['touchstart', TouchDown],\n      ['touchend', TouchUp],\n      ['touchcancel', TouchUp],\n      ['touchmove', TouchMove]\n    ];\n    if(this.dragControl) {\n      handlers[cid].push(['mousedown', MouseDown]);\n      handlers[cid].push(['selectstart', Nop]);\n    }\n    if(this.wheelZoom) {\n      handlers[cid].push(['mousewheel', MouseWheel]);\n      handlers[cid].push(['DOMMouseScroll', MouseWheel]);\n    }\n    if(this.scrollPause) {\n      handlers[cid].push(['scroll', Scroll, window]);\n    }\n    for(i = 0; i < handlers[cid].length; ++i) {\n      p = handlers[cid][i];\n      AddHandler(p[0], p[1], p[2] ? p[2] : c);\n    }\n  }\n  if(!TagCanvas.started) {\n    raf = window.requestAnimationFrame = window.requestAnimationFrame ||\n      window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame ||\n      window.msRequestAnimationFrame;\n    TagCanvas.NextFrame = raf ? TagCanvas.NextFrameRAF :\n      TagCanvas.NextFrameTimeout;\n    TagCanvas.interval = this.interval;\n    TagCanvas.NextFrame(this.interval);\n    TagCanvas.started = 1;\n  }\n}\nTCproto = TagCanvas.prototype;\nTCproto.SourceElements = function() {\n  if(doc.querySelectorAll)\n    return doc.querySelectorAll('#' + this.source);\n  return [doc.getElementById(this.source)];\n};\nTCproto.HideTags = function() {\n  var el = this.SourceElements(), i;\n  for(i = 0; i < el.length; ++i)\n    el[i].style.display = 'none';\n};\nTCproto.GetTags = function() {\n  var el = this.SourceElements(), etl, tl = [], i, j, k;\n  for(k = 0; k <= this.repeatTags; ++k) {\n    for(i = 0; i < el.length; ++i) {\n      etl = el[i].getElementsByTagName('a');\n      for(j = 0; j < etl.length; ++j) {\n        tl.push(etl[j]);\n      }\n    }\n  }\n  return tl;\n};\nTCproto.Message = function(text) {\n  var tl = [], i, p, tc = text.split(''), a, t, x, z;\n  for(i = 0; i < tc.length; ++i) {\n    if(tc[i] != ' ') {\n      p = i - tc.length / 2;\n      a = doc.createElement('A');\n      a.href = '#';\n      a.innerText = tc[i];\n      x = 100 * sin(p / 9);\n      z = -100 * cos(p / 9);\n      t = new Tag(this, tc[i], a, [x,0,z], 2, 18, '#000', '#fff', 0, 0, 0,\n        'monospace', 2, tc[i]);\n      t.Init();\n      tl.push(t);\n    }\n  }\n  return tl;\n};\nTCproto.CreateTag = function(e) {\n  var im, i, t, txt, ts, font, bc, boc, p = [0, 0, 0];\n  if('text' != this.imageMode) {\n    im = e.getElementsByTagName('img');\n    if(im.length) {\n      i = new Image;\n      i.src = im[0].src;\n\n      if(!this.imageMode) {\n        t = new Tag(this, \"\", e, p, 0, 0);\n        t.SetImage(i);\n        //t.Init();\n        AddImage(i, im[0], t, this);\n        return t;\n      }\n    }\n  }\n  if('image' != this.imageMode) {\n    ts = new TextSplitter(e);\n    txt = ts.Lines();\n    if(!ts.Empty()) {\n      font = this.textFont || FixFont(GetProperty(e,'font-family'));\n      if(this.splitWidth)\n        txt = ts.SplitWidth(this.splitWidth, this.ctxt, font, this.textHeight);\n\n      bc = this.bgColour == 'tag' ? GetProperty(e, 'background-color') :\n        this.bgColour;\n      boc = this.bgOutline == 'tag' ? GetProperty(e, 'color') : this.bgOutline;\n    } else {\n      ts = null;\n    }\n  }\n  if(ts || i) {\n    t = new Tag(this, txt, e, p, 2, this.textHeight + 2,\n      this.textColour || GetProperty(e,'color'), bc, this.bgRadius,\n      boc, this.bgOutlineThickness, font, this.padding, ts && ts.original);\n    if(i) {\n      t.SetImage(i);\n      AddImage(i, im[0], t, this);\n    } else {\n      t.Init();\n    }\n    return t;\n  }\n};\nTCproto.UpdateTag = function(t, a) {\n  var colour = this.textColour || GetProperty(a, 'color'),\n    font = this.textFont || FixFont(GetProperty(a, 'font-family')),\n    bc = this.bgColour == 'tag' ? GetProperty(a, 'background-color') :\n      this.bgColour, boc = this.bgOutline == 'tag' ? GetProperty(a, 'color') :\n      this.bgOutline;\n  t.a = a;\n  t.title = a.title;\n  if(t.colour != colour || t.textFont != font || t.bgColour != bc ||\n    t.bgOutline != boc)\n    t.SetFont(font, colour, bc, boc);\n};\nTCproto.Weight = function(tl) {\n  var ll = tl.length, w, i, s, weights = [], valid,\n    wfrom = this.weightFrom ? this.weightFrom.split(/[, ]/) : [null],\n    wl = wfrom.length;\n  for(i = 0; i < ll; ++i) {\n    weights[i] = [];\n    for(s = 0; s < wl; ++s) {\n      w = FindWeight(tl[i].a, wfrom[s], this.textHeight);\n      if(!this.max_weight[s] || w > this.max_weight[s])\n        this.max_weight[s] = w;\n      if(!this.min_weight[s] || w < this.min_weight[s])\n        this.min_weight[s] = w;\n      weights[i][s] = w;\n    }\n  }\n  for(s = 0; s < wl; ++s) {\n    if(this.max_weight[s] > this.min_weight[s])\n      valid = 1;\n  }\n  if(valid) {\n    for(i = 0; i < ll; ++i) {\n      tl[i].SetWeight(weights[i]);\n    }\n  }\n};\nTCproto.Load = function() {\n  var tl = this.GetTags(), taglist = [], shape, t,\n    shapeArgs, rx, ry, rz, vl, i, tagmap = [], pfuncs = {\n      sphere: PointsOnSphere,\n      vcylinder: PointsOnCylinderV,\n      hcylinder: PointsOnCylinderH,\n      vring: PointsOnRingV,\n      hring: PointsOnRingH\n    };\n\n  if(tl.length) {\n    tagmap.length = tl.length;\n    for(i = 0; i < tl.length; ++i)\n      tagmap[i] = i;\n    this.shuffleTags && Shuffle(tagmap);\n    rx = 100 * this.radiusX;\n    ry = 100 * this.radiusY;\n    rz = 100 * this.radiusZ;\n    this.max_radius = max(rx, max(ry, rz));\n\n    for(i = 0; i < tl.length; ++i) {\n      t = this.CreateTag(tl[tagmap[i]]);\n      if(t)\n        taglist.push(t);\n    }\n    this.weight && this.Weight(taglist, true);\n  \n    if(this.shapeArgs) {\n      this.shapeArgs[0] = taglist.length;\n    } else {\n      shapeArgs = this.shape.toString().split(/[(),]/);\n      shape = shapeArgs.shift();\n      if(typeof window[shape] === 'function')\n        this.shape = window[shape];\n      else\n        this.shape = pfuncs[shape] || pfuncs.sphere;\n      this.shapeArgs = [taglist.length, rx, ry, rz].concat(shapeArgs);\n    }\n    vl = this.shape.apply(this, this.shapeArgs);\n    this.listLength = taglist.length;\n    for(i = 0; i < taglist.length; ++i)\n      taglist[i].position = new Vector(vl[i][0], vl[i][1], vl[i][2]);\n  }\n  if(this.noTagsMessage && !taglist.length) {\n    i = (this.imageMode && this.imageMode != 'both' ? this.imageMode + ' ': '');\n    taglist = this.Message('No ' + i + 'tags');\n  }\n  this.taglist = taglist;\n};\nTCproto.Update = function() {\n  var tl = this.GetTags(), newlist = [],\n    taglist = this.taglist, found,\n    added = [], removed = [], vl, ol, nl, i, j;\n\n  if(!this.shapeArgs)\n    return this.Load();\n\n  if(tl.length) {\n    nl = this.listLength = tl.length;\n    ol = taglist.length;\n\n    // copy existing list, populate \"removed\"\n    for(i = 0; i < ol; ++i) {\n      newlist.push(taglist[i]);\n      removed.push(i);\n    }\n\n    // find added and removed tags\n    for(i = 0; i < nl; ++i) {\n      for(j = 0, found = 0; j < ol; ++j) {\n        if(taglist[j].EqualTo(tl[i])) {\n          this.UpdateTag(newlist[j], tl[i]);\n          found = removed[j] = -1;\n        }\n      }\n      if(!found)\n        added.push(i);\n    }\n\n    // clean out found tags from removed list\n    for(i = 0, j = 0; i < ol; ++i) {\n      if(removed[j] == -1)\n        removed.splice(j,1);\n      else\n        ++j;\n    }\n\n    // insert new tags in gaps where old tags removed\n    if(removed.length) {\n      Shuffle(removed);\n      while(removed.length && added.length) {\n        i = removed.shift();\n        j = added.shift();\n        newlist[i] = this.CreateTag(tl[j]);\n      }\n\n      // remove any more (in reverse order)\n      removed.sort(function(a,b) {return a-b});\n      while(removed.length) {\n        newlist.splice(removed.pop(), 1);\n      }\n    }\n\n    // add any extra tags\n    j = newlist.length / (added.length + 1);\n    i = 0;\n    while(added.length) {\n      newlist.splice(ceil(++i * j), 0, this.CreateTag(tl[added.shift()]));\n    }\n\n    // assign correct positions to tags\n    this.shapeArgs[0] = nl = newlist.length;\n    vl = this.shape.apply(this, this.shapeArgs);\n    for(i = 0; i < nl; ++i)\n      newlist[i].position = new Vector(vl[i][0], vl[i][1], vl[i][2]);\n\n    // reweight tags\n    this.weight && this.Weight(newlist);\n  }\n  this.taglist = newlist;\n};\nTCproto.SetShadow = function(c) {\n  c.shadowBlur = this.shadowBlur;\n  c.shadowOffsetX = this.shadowOffset[0];\n  c.shadowOffsetY = this.shadowOffset[1];\n};\nTCproto.Draw = function(t) {\n  if(this.paused)\n    return;\n  var cv = this.canvas, cw = cv.width, ch = cv.height, max_sc = 0,\n    tdelta = (t - this.time) * TagCanvas.interval / 1000,\n    x = cw / 2 + this.offsetX, y = ch / 2 + this.offsetY, c = this.ctxt,\n    active, a, i, aindex = -1, tl = this.taglist, l = tl.length,\n    frontsel = this.frontSelect, centreDrawn = (this.centreFunc == Nop), fixed;\n  this.time = t;\n  if(this.frozen && this.drawn)\n    return this.Animate(cw,ch,tdelta);\n  fixed = this.AnimateFixed();\n  c.setTransform(1,0,0,1,0,0);\n  for(i = 0; i < l; ++i)\n    tl[i].Calc(this.transform, this.fixedAlpha);\n  tl = SortList(tl, function(a,b) {return b.z-a.z});\n  \n  if(fixed && this.fixedAnim.active) {\n    active = this.fixedAnim.tag.UpdateActive(c, x, y);\n  } else {\n    this.active = null;\n    for(i = 0; i < l; ++i) {\n      a = this.mx >= 0 && this.my >= 0 && this.taglist[i].CheckActive(c, x, y);\n      if(a && a.sc > max_sc && (!frontsel || a.z <= 0)) {\n        active = a;\n        aindex = i;\n        active.tag = this.taglist[i];\n        max_sc = a.sc;\n      }\n    }\n    this.active = active;\n  }\n\n  this.txtOpt || (this.shadow && this.SetShadow(c));\n  c.clearRect(0,0,cw,ch);\n  for(i = 0; i < l; ++i) {\n    if(!centreDrawn && tl[i].z <= 0) {\n      // run the centreFunc if the next tag is at the front\n      try { this.centreFunc(c, cw, ch, x, y); }\n      catch(e) {\n        alert(e);\n        // don't run it again\n        this.centreFunc = Nop;\n      }\n      centreDrawn = true;\n    }\n\n    if(!(active && active.tag == tl[i] && active.PreDraw(c, tl[i], x, y)))\n      tl[i].Draw(c, x, y);\n    active && active.tag == tl[i] && active.PostDraw(c);\n  }\n  if(this.freezeActive && active) {\n    this.Freeze();\n  } else {\n    this.UnFreeze();\n    this.drawn = (l == this.listLength);\n  }\n  if(this.fixedCallback) {\n    this.fixedCallback(this,this.fixedCallbackTag);\n    this.fixedCallback = null;\n  }\n  fixed || this.Animate(cw, ch, tdelta);\n  active && active.LastDraw(c);\n  cv.style.cursor = active ? this.activeCursor : '';\n  this.Tooltip(active,this.taglist[aindex]);\n};\nTCproto.TooltipNone = function() { };\nTCproto.TooltipNative = function(active,tag) {\n  if(active)\n    this.canvas.title = tag && tag.title ? tag.title : '';\n  else\n    this.canvas.title = this.ctitle;\n};\nTCproto.SetTTDiv = function(title, tag) {\n  var tc = this, s = tc.ttdiv.style;\n  if(title != tc.ttdiv.innerHTML)\n    s.display = 'none';\n  tc.ttdiv.innerHTML = title;\n  tag && (tag.title = tc.ttdiv.innerHTML);\n  if(s.display == 'none' && ! tc.tttimer) {\n    tc.tttimer = setTimeout(function() {\n      var p = AbsPos(tc.canvas.id);\n      s.display = 'block';\n      s.left = p.x + tc.mx + 'px';\n      s.top = p.y + tc.my + 24 + 'px';\n      tc.tttimer = null;\n    }, tc.tooltipDelay);\n  }\n};\nTCproto.TooltipDiv = function(active,tag) {\n  if(active && tag && tag.title) {\n    this.SetTTDiv(tag.title, tag);\n  } else if(!active && this.mx != -1 && this.my != -1 && this.ctitle.length) {\n    this.SetTTDiv(this.ctitle);\n  } else {\n    this.ttdiv.style.display = 'none';\n  }\n};\nTCproto.Transform = function(tc, p, y) {\n  if(p || y) {\n    var sp = sin(p), cp = cos(p), sy = sin(y), cy = cos(y),\n      ym = new Matrix([cy,0,sy, 0,1,0, -sy,0,cy]),\n      pm = new Matrix([1,0,0, 0,cp,-sp, 0,sp,cp]);\n    tc.transform = tc.transform.mul(ym.mul(pm));\n  }\n};\nTCproto.AnimateFixed = function() {\n  var fa, t1, angle, m, d;\n  if(this.fadeIn) {\n    t1 = TimeNow() - this.startTime;\n    if(t1 >= this.fadeIn) {\n      this.fadeIn = 0;\n      this.fixedAlpha = 1;\n    } else {\n      this.fixedAlpha = t1 / this.fadeIn;\n    }\n  }\n  if(this.fixedAnim) {\n    if(!this.fixedAnim.transform)\n      this.fixedAnim.transform = this.transform;\n    fa = this.fixedAnim, t1 = TimeNow() - fa.t0, angle = fa.angle,\n      m, d = this.animTiming(fa.t, t1);\n    this.transform = fa.transform;\n    if(t1 >= fa.t) {\n      this.fixedCallbackTag = fa.tag;\n      this.fixedCallback = fa.cb;\n      this.fixedAnim = this.yaw = this.pitch = 0;\n    } else {\n      angle *= d;\n    }\n    m = Matrix.Rotation(angle, fa.axis);\n    this.transform = this.transform.mul(m);\n    return (this.fixedAnim != 0);\n  }\n  return false;\n};\nTCproto.AnimatePosition = function(w, h, t) {\n  var tc = this, x = tc.mx, y = tc.my, s, r;\n  if(!tc.frozen && x >= 0 && y >= 0 && x < w && y < h) {\n    s = tc.maxSpeed, r = tc.reverse ? -1 : 1;\n    tc.lx || (tc.yaw = ((x * 2 * s / w) - s) * r * t);\n    tc.ly || (tc.pitch = ((y * 2 * s / h) - s) * -r * t);\n    tc.initial = null;\n  } else if(!tc.initial) {\n    if(tc.frozen && !tc.freezeDecel)\n      tc.yaw = tc.pitch = 0;\n    else\n      tc.Decel(tc);\n  }\n  this.Transform(tc, tc.pitch, tc.yaw);\n};\nTCproto.AnimateDrag = function(w, h, t) {\n  var tc = this, rs = 100 * t * tc.maxSpeed / tc.max_radius / tc.zoom;\n  if(tc.dx || tc.dy) {\n    tc.lx || (tc.yaw = tc.dx * rs / tc.stretchX);\n    tc.ly || (tc.pitch = tc.dy * -rs / tc.stretchY);\n    tc.dx = tc.dy = 0;\n    tc.initial = null;\n  } else if(!tc.initial) {\n    tc.Decel(tc);\n  }\n  this.Transform(tc, tc.pitch, tc.yaw);\n};\nTCproto.Freeze = function() {\n  if(!this.frozen) {\n    this.preFreeze = [this.yaw, this.pitch];\n    this.frozen = 1;\n    this.drawn = 0;\n  }\n};\nTCproto.UnFreeze = function() {\n  if(this.frozen) {\n    this.yaw = this.preFreeze[0];\n    this.pitch = this.preFreeze[1];\n    this.frozen = 0;\n  }\n};\nTCproto.Decel = function(tc) {\n  var s = tc.minSpeed, ay = abs(tc.yaw), ap = abs(tc.pitch);\n  if(!tc.lx && ay > s)\n    tc.yaw = ay > tc.z0 ? tc.yaw * tc.decel : 0;\n  if(!tc.ly && ap > s)\n    tc.pitch = ap > tc.z0 ? tc.pitch * tc.decel : 0;\n};\nTCproto.Zoom = function(r) {\n  this.z2 = this.z1 * (1/r);\n  this.drawn = 0;\n};\nTCproto.Clicked = function(e) {\n  var a = this.active;\n  try {\n    if(a && a.tag)\n      if(this.clickToFront === false || this.clickToFront === null)\n        a.tag.Clicked(e);\n      else\n        this.TagToFront(a.tag, this.clickToFront, function() {\n          a.tag.Clicked(e);\n        }, true);\n  } catch(ex) {\n  }\n};\nTCproto.Wheel = function(i) {\n  var z = this.zoom + this.zoomStep * (i ? 1 : -1);\n  this.zoom = min(this.zoomMax,max(this.zoomMin,z));\n  this.Zoom(this.zoom);\n};\nTCproto.BeginDrag = function(e) {\n  this.down = EventXY(e, this.canvas);\n  e.cancelBubble = true;\n  e.returnValue = false;\n  e.preventDefault && e.preventDefault();\n};\nTCproto.Drag = function(e, p) {\n  if(this.dragControl && this.down) {\n    var t2 = this.dragThreshold * this.dragThreshold,\n      dx = p.x - this.down.x, dy = p.y - this.down.y;\n    if(this.dragging || dx * dx + dy * dy > t2) {\n      this.dx = dx;\n      this.dy = dy;\n      this.dragging = 1;\n      this.down = p;\n    }\n  }\n  return this.dragging;\n};\nTCproto.EndDrag = function() {\n  var res = this.dragging;\n  this.dragging = this.down = null;\n  return res;\n};\nfunction PinchDistance(e) {\n  var t1 = e.targetTouches[0], t2 = e.targetTouches[1];\n  return sqrt(pow(t2.pageX - t1.pageX, 2) + pow(t2.pageY - t1.pageY, 2));\n}\nTCproto.BeginPinch = function(e) {\n  this.pinched = [PinchDistance(e), this.zoom];\n  e.preventDefault && e.preventDefault();\n};\nTCproto.Pinch = function(e) {\n  var z, d, p = this.pinched;\n  if(!p)\n    return;\n  d = PinchDistance(e);\n  z = p[1] * d / p[0];\n  this.zoom = min(this.zoomMax,max(this.zoomMin,z));\n  this.Zoom(this.zoom);\n};\nTCproto.EndPinch = function(e) {\n  this.pinched = null;\n};\nTCproto.Pause = function() { this.paused = true; };\nTCproto.Resume = function() { this.paused = false; };\nTCproto.SetSpeed = function(i) {\n  this.initial = i;\n  this.yaw = i[0] * this.maxSpeed;\n  this.pitch = i[1] * this.maxSpeed;\n};\nTCproto.FindTag = function(t) {\n  if(!Defined(t))\n    return null;\n  Defined(t.index) && (t = t.index);\n  if(!IsObject(t))\n    return this.taglist[t];\n  var srch, tgt, i;\n  if(Defined(t.id))\n    srch = 'id', tgt = t.id;\n  else if(Defined(t.text))\n    srch = 'innerText', tgt = t.text;\n\n  for(i = 0; i < this.taglist.length; ++i)\n    if(this.taglist[i].a[srch] == tgt)\n      return this.taglist[i];\n};\nTCproto.RotateTag = function(tag, lt, lg, time, callback, active) {\n  var t = tag.Calc(this.transform, 1), v1 = new Vector(t.x, t.y, t.z),\n    v2 = MakeVector(lg, lt), angle = v1.angle(v2), u = v1.cross(v2).unit();\n  if(angle == 0) {\n    this.fixedCallbackTag = tag;\n    this.fixedCallback = callback;\n  } else {\n    this.fixedAnim = {\n      angle: -angle,\n      axis: u,\n      t: time,\n      t0: TimeNow(),\n      cb: callback,\n      tag: tag,\n      active: active\n    };\n  }\n};\nTCproto.TagToFront = function(tag, time, callback, active) {\n  this.RotateTag(tag, 0, 0, time, callback, active);\n};\nTagCanvas.Start = function(id,l,o) {\n  TagCanvas.Delete(id);\n  TagCanvas.tc[id] = new TagCanvas(id,l,o);\n};\nfunction tccall(f,id) {\n  TagCanvas.tc[id] && TagCanvas.tc[id][f]();\n}\nTagCanvas.Linear = function(t, t0) { return t0 / t; }\nTagCanvas.Smooth = function(t, t0) { return 0.5 - cos(t0 * Math.PI / t) / 2; }\nTagCanvas.Pause = function(id) { tccall('Pause',id); };\nTagCanvas.Resume = function(id) { tccall('Resume',id); };\nTagCanvas.Reload = function(id) { tccall('Load',id); };\nTagCanvas.Update = function(id) { tccall('Update',id); };\nTagCanvas.SetSpeed = function(id, speed) {\n  if(IsObject(speed) && TagCanvas.tc[id] &&\n    !isNaN(speed[0]) && !isNaN(speed[1])) {\n    TagCanvas.tc[id].SetSpeed(speed);\n    return true;\n  }\n  return false;\n};\nTagCanvas.TagToFront = function(id, options) {\n  if(!IsObject(options))\n    return false;\n  options.lat = options.lng = 0;\n  return TagCanvas.RotateTag(id, options);\n};\nTagCanvas.RotateTag = function(id, options) {\n  if(IsObject(options) && TagCanvas.tc[id]) {\n    if(isNaN(options.time))\n      options.time = 500;\n    var tt = TagCanvas.tc[id].FindTag(options);\n    if(tt) {\n      TagCanvas.tc[id].RotateTag(tt, options.lat, options.lng,\n        options.time, options.callback, options.active);\n      return true;\n    }\n  }\n  return false;\n};\nTagCanvas.Delete = function(id) {\n  var i, c;\n  if(handlers[id]) {\n    c = doc.getElementById(id);\n    if(c) {\n      for(i = 0; i < handlers[id].length; ++i)\n        RemoveHandler(handlers[id][i][0], handlers[id][i][1], c);\n    }\n  }\n  delete handlers[id];\n  delete TagCanvas.tc[id];\n};\nTagCanvas.NextFrameRAF = function() {\n  requestAnimationFrame(DrawCanvasRAF);\n};\nTagCanvas.NextFrameTimeout = function(iv) {\n  setTimeout(DrawCanvas, iv);\n};\nTagCanvas.tc = {};\nTagCanvas.options = {\nz1: 20000,\nz2: 20000,\nz0: 0.0002,\nfreezeActive: false,\nfreezeDecel: false,\nactiveCursor: 'pointer',\npulsateTo: 1,\npulsateTime: 3,\nreverse: false,\ndepth: 0.5,\nmaxSpeed: 0.05,\nminSpeed: 0,\ndecel: 0.95,\ninterval: 20,\nminBrightness: 0.1,\nmaxBrightness: 1,\noutlineColour: '#ffff99',\noutlineThickness: 2,\noutlineOffset: 5,\noutlineMethod: 'outline',\noutlineRadius: 0,\ntextColour: '#ff99ff',\ntextHeight: 15,\ntextFont: 'Helvetica, Arial, sans-serif',\nshadow: '#000',\nshadowBlur: 0,\nshadowOffset: [0,0],\ninitial: null,\nhideTags: true,\nzoom: 1,\nweight: false,\nweightMode: 'size',\nweightFrom: null,\nweightSize: 1,\nweightSizeMin: null,\nweightSizeMax: null,\nweightGradient: {0:'#f00', 0.33:'#ff0', 0.66:'#0f0', 1:'#00f'},\ntxtOpt: true,\ntxtScale: 2,\nfrontSelect: false,\nwheelZoom: true,\nzoomMin: 0.3,\nzoomMax: 3,\nzoomStep: 0.05,\nshape: 'sphere',\nlock: null,\ntooltip: null,\ntooltipDelay: 300,\ntooltipClass: 'tctooltip',\nradiusX: 1,\nradiusY: 1,\nradiusZ: 1,\nstretchX: 1,\nstretchY: 1,\noffsetX: 0,\noffsetY: 0,\nshuffleTags: false,\nnoSelect: false,\nnoMouse: false,\nimageScale: 1,\npaused: false,\ndragControl: false,\ndragThreshold: 4,\ncentreFunc: Nop,\nsplitWidth: 0,\nanimTiming: 'Smooth',\nclickToFront: false,\nfadeIn: 0,\npadding: 0,\nbgColour: null,\nbgRadius: 0,\nbgOutline: null,\nbgOutlineThickness: 0,\noutlineIncrease: 4,\ntextAlign: 'centre',\ntextVAlign: 'middle',\nimageMode: null,\nimagePosition: null,\nimagePadding: 2,\nimageAlign: 'centre',\nimageVAlign: 'middle',\nnoTagsMessage: true,\ncentreImage: null,\npinchZoom: false,\nrepeatTags: 0,\nminTags: 0,\nimageRadius: 0,\nscrollPause: false,\noutlineDash: 0,\noutlineDashSpace: 0,\noutlineDashSpeed: 1\n};\nfor(i in TagCanvas.options) TagCanvas[i] = TagCanvas.options[i];\nwindow.TagCanvas = TagCanvas;\n// set a flag for when the window has loaded\nAddHandler('load',function(){TagCanvas.loaded=1},window);\n})();\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}